{
    "props": {
        "pageProps": {
            "query": {
                "id": "9c71c42c27004fc78bd7b8cd3c41ae0d"
            },
            "ieBrowser": false,
            "needRefresh": false,
            "writingDetail": {
                "id": 82798,
                "outId": "9c71c42c27004fc78bd7b8cd3c41ae0d",
                "articleOutId": "9c71c42c27004fc78bd7b8cd3c41ae0d",
                "html": "<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">我们知道Oracle数据库中有自动block修复功能，在主备环境中，如果主库或者备库出现数据坏块，那么Oracle ADG能够进行自动修复。这实际上是Oracle 11.2.0.3版本所引入的一个特性auto block media recover,简称bmr. 这个功能有相关的数据库参数来进行控制，决定是否启用。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DESCRIB<br>------------------------------------&nbsp;------------&nbsp;------------------------------------------------<br>_auto_bmr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enabled&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">enable</span>/<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">disable</span>&nbsp;Auto&nbsp;BMR<br>_auto_bmr_req_timeout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Auto&nbsp;BMR&nbsp;Requester&nbsp;Timeout<br>_auto_bmr_sess_threshold&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Auto&nbsp;BMR&nbsp;Request&nbsp;Session&nbsp;Threshold<br>_auto_bmr_pub_timeout&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Auto&nbsp;BMR&nbsp;Publish&nbsp;Timeout<br>_auto_bmr_fc_time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;60&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Auto&nbsp;BMR&nbsp;Flood&nbsp;Control&nbsp;Time<br>_auto_bmr_bg_time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3600&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Auto&nbsp;BMR&nbsp;Process&nbsp;Run&nbsp;Time<br>_auto_bmr_sys_threshold&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;100&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Auto&nbsp;BMR&nbsp;Request&nbsp;System&nbsp;Threshold<br>_auto_bmr_max_rowno&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1024&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$krbabrstat</span>&nbsp;Max&nbsp;number&nbsp;of&nbsp;rows<br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">Oracle的这个功能很强大，也非常人性化。当然这个功能的基本原理跟blockrecover类似，copy block+ apply redo。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">那么如果你使用国产数据库，比如MogDB，遇到文件损坏或者坏块怎么办呢？</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">我们知道MogDB使用的文件系统，而openGauss系数据库的表本质上就是一个独立的文件。当文件损坏的时候，那么实际上MogDB也提供了相关的函数来应对这个场景。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">这里我给大家简单演示一下。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">[omm1@mogdb1&nbsp;~]$&nbsp;gsql&nbsp;-r<br>gsql&nbsp;((MogDB&nbsp;5.0.8&nbsp;build&nbsp;41aa0432)&nbsp;compiled&nbsp;at&nbsp;2024-07-26&nbsp;12:43:48&nbsp;commit&nbsp;0&nbsp;last&nbsp;mr&nbsp;1804&nbsp;)<br>Non-SSL&nbsp;connection&nbsp;(SSL&nbsp;connection&nbsp;is&nbsp;recommended&nbsp;when&nbsp;requiring&nbsp;high-security)<br>Type&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"help\"</span>&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">for</span>&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">help</span>.<br><br>MogDB=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;\\l</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&nbsp;of&nbsp;databases<br>&nbsp;&nbsp;&nbsp;Name&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Owner&nbsp;|&nbsp;Encoding&nbsp;|&nbsp;Collate&nbsp;|&nbsp;Ctype&nbsp;|&nbsp;Access&nbsp;privileges&nbsp;|&nbsp;Compatibility&nbsp;<br>-----------+-------+----------+---------+-------+-------------------+---------------<br>&nbsp;aa&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;aa&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;UTF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;A<br>&nbsp;bb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;bb&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;UTF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;B<br>&nbsp;postgres&nbsp;&nbsp;|&nbsp;omm1&nbsp;&nbsp;|&nbsp;UTF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;A<br>&nbsp;template0&nbsp;|&nbsp;omm1&nbsp;&nbsp;|&nbsp;UTF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;=c/omm1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+|&nbsp;A<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;omm1=CTc/omm1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<br>&nbsp;template1&nbsp;|&nbsp;omm1&nbsp;&nbsp;|&nbsp;UTF8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;=c/omm1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+|&nbsp;A<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;omm1=CTc/omm1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;<br>(5&nbsp;rows)<br><br>MogDB=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;\\c&nbsp;aa</span><br>Non-SSL&nbsp;connection&nbsp;(SSL&nbsp;connection&nbsp;is&nbsp;recommended&nbsp;when&nbsp;requiring&nbsp;high-security)<br>You&nbsp;are&nbsp;now&nbsp;connected&nbsp;to&nbsp;database&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"aa\"</span>&nbsp;as&nbsp;user&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"omm1\"</span>.<br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;&nbsp;create&nbsp;table&nbsp;test_corrupt(id&nbsp;int,name&nbsp;varchar(100));</span><br>CREATE&nbsp;TABLE<br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;insert&nbsp;into&nbsp;test_corrupt&nbsp;select&nbsp;generate_series,generate_series||'MogDB&nbsp;or&nbsp;MogDB&nbsp;Cube'&nbsp;from&nbsp;generate_series(1,100000);</span><br>INSERT&nbsp;0&nbsp;100000<br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;SELECT&nbsp;pg_relation_filepath('test_corrupt');</span><br>&nbsp;pg_relation_filepath&nbsp;<br>----------------------<br>&nbsp;base/16779/31665<br>(1&nbsp;row)<br><br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;checkpoint;</span><br>CHECKPOINT<br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;</span><br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;\\q</span><br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">万事具备只欠东风！这里模拟删除这个表文件。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">注意！注意！如果是生产库，千万别模拟！</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">[omm1@mogdb1&nbsp;~]$&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">cd</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$PGDATA</span><br>[omm1@mogdb1&nbsp;data]$&nbsp;rm&nbsp;-rf&nbsp;&nbsp;base/16779/31665<br>[omm1@mogdb1&nbsp;data]$&nbsp;<br>[omm1@mogdb1&nbsp;data]$&nbsp;gsql&nbsp;-r&nbsp;-d&nbsp;aa<br>gsql&nbsp;((MogDB&nbsp;5.0.8&nbsp;build&nbsp;41aa0432)&nbsp;compiled&nbsp;at&nbsp;2024-07-26&nbsp;12:43:48&nbsp;commit&nbsp;0&nbsp;last&nbsp;mr&nbsp;1804&nbsp;)<br>Non-SSL&nbsp;connection&nbsp;(SSL&nbsp;connection&nbsp;is&nbsp;recommended&nbsp;when&nbsp;requiring&nbsp;high-security)<br>Type&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"help\"</span>&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">for</span>&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">help</span>.<br><br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;select&nbsp;count(1)&nbsp;from&nbsp;test_corrupt;</span><br>ERROR:&nbsp;&nbsp;could&nbsp;not&nbsp;open&nbsp;file&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"base/16779/31665\"</span>:&nbsp;No&nbsp;such&nbsp;file&nbsp;or&nbsp;directory<br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;</span><br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">人为删除这个表文件之后，我们登陆数据库查询发现已经找不到文件了。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;select&nbsp;*&nbsp;from&nbsp;gs_verify_data_file();</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;node_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;rel_oid&nbsp;|&nbsp;&nbsp;&nbsp;rel_name&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;miss_file_path&nbsp;&nbsp;<br>-------------------+---------+--------------+------------------<br>&nbsp;dn_6001_6002_6003&nbsp;|&nbsp;&nbsp;&nbsp;31665&nbsp;|&nbsp;test_corrupt&nbsp;|&nbsp;base/16779/31665<br>(1&nbsp;row)<br><br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;</span><br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;\\timing&nbsp;on</span><br>Timing&nbsp;is&nbsp;on.<br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;select&nbsp;*&nbsp;from&nbsp;gs_repair_file(31665,'base/16779/31665',600);</span><br>&nbsp;gs_repair_file&nbsp;<br>----------------<br>&nbsp;t<br>(1&nbsp;row)<br><br>Time:&nbsp;530.816&nbsp;ms<br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;select&nbsp;count(1)&nbsp;from&nbsp;test_corrupt;</span><br>&nbsp;count&nbsp;&nbsp;<br>--------<br>&nbsp;100000<br>(1&nbsp;row)<br><br>Time:&nbsp;33.093&nbsp;ms<br>aa=<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;</span><br><br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">大家可以看到，通过gs_verify_data_file 函数可以表文件进行check检查，有点类似Oracle dbv工具。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">最后一步是通过gs_repair_file函数来进行文件自动修复。可以看到，非常顺利的修复了这个表文件。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">那么这个修复具体是什么逻辑呢？实际上我们看看log 就看发现一些线索。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">2024-08-20&nbsp;15:55:09.762&nbsp;omm1&nbsp;aa&nbsp;[<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">local</span>]&nbsp;47016331712256&nbsp;0[0:0<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#0]&nbsp;2251799813808012&nbsp;[REMOTE]&nbsp;LOG:&nbsp;&nbsp;remote&nbsp;read&nbsp;page&nbsp;size,&nbsp;file&nbsp;base/16779/31665&nbsp;from&nbsp;172.20.22.128@17135</span><br>2024-08-20&nbsp;15:55:09.884&nbsp;omm1&nbsp;aa&nbsp;[<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">local</span>]&nbsp;47016331712256&nbsp;0[0:0<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#0]&nbsp;2251799813808012&nbsp;[REMOTE]&nbsp;LOG:&nbsp;&nbsp;remote&nbsp;read&nbsp;page,&nbsp;file&nbsp;base/16779/31665&nbsp;block&nbsp;start&nbsp;is&nbsp;0&nbsp;from&nbsp;172.20.22.126@54520</span><br>2024-08-20&nbsp;15:55:10.290&nbsp;omm1&nbsp;aa&nbsp;[<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">local</span>]&nbsp;47016331712256&nbsp;0[0:0<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#0]&nbsp;2251799813808012&nbsp;[REDO]&nbsp;LOG:&nbsp;&nbsp;file&nbsp;rename&nbsp;from&nbsp;base/16779/31665.repair&nbsp;to&nbsp;base/16779/31665&nbsp;finish</span><br><br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">大家可以看到，本质上修复的这个文件是从备库去拉取的，同时再应用本地redo。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">关于提到的几个函数的功能和一些详细描述，大家可以参考MogDB 官方文档。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">https://docs.mogdb.io/zh/mogdb/v5.0/data-damage-detection-and-repair-functions</p>",
                "title": "震惊！国产数据库居然也有数据坏块自动修复功能？",
                "categoryId": 1,
                "categoryName": "后端",
                "tagId": 170,
                "tagName": "数据库",
                "userId": 57407,
                "userOutId": "479919747659",
                "username": "lizhenxu007",
                "avatar": "https://files.mdnice.com/pic/3d17b156-d245-4cc1-b20f-86262ec15a54.png",
                "description": "我们知道Oracle数据库中有自动block修复功能，在主备环境中，如果主库或者备库出现数据坏块，那么OracleADG能够进行自动修复。这实际上是Oracle11.2.0.3版本所引入的一个特性au",
                "level": 1,
                "publishTime": "2024/08/29",
                "readingNum": 4,
                "likeNum": 0,
                "introduction": null,
                "followWords": null,
                "followPic": null,
                "isFollowing": false,
                "isLike": false,
                "isSelf": false,
                "type": 1,
                "isVisible": true,
                "invisibleReason": null,
                "writingColumn": {
                    "columnOutId": "59257a23a7e942389e4cf3aab40948a1",
                    "name": "默认专栏",
                    "briefIntro": "这是一个默认专栏",
                    "cover": "https://files.mdnice.com/common/community/default-column-cover.jpg",
                    "writingNum": 24,
                    "createTime": "2024-08-06 19:03"
                }
            }
        },
        "__N_SSP": true
    },
    "page": "/writing/[id]",
    "query": {
        "id": "9c71c42c27004fc78bd7b8cd3c41ae0d"
    },
    "buildId": "ErZPkD4oq6iwH2nj6Dpcx",
    "isFallback": false,
    "gssp": true,
    "appGip": true
}