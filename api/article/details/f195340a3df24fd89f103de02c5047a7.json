{
    "props": {
        "pageProps": {
            "query": {
                "id": "f195340a3df24fd89f103de02c5047a7"
            },
            "ieBrowser": false,
            "needRefresh": false,
            "writingDetail": {
                "id": 85429,
                "outId": "f195340a3df24fd89f103de02c5047a7",
                "articleOutId": "f195340a3df24fd89f103de02c5047a7",
                "html": "<h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: url('https://files.mdnice.com/fullstack-2.png'); background-origin: padding-box; background-position-x: 50%; background-position-y: 50%; background-repeat: no-repeat; background-size: 30px 30px; width: auto; height: auto; align-items: unset; box-shadow: none; display: flex; flex-direction: unset; float: unset; justify-content: center; line-height: 1.5em; overflow-x: unset; overflow-y: unset; padding-top: 0px; padding-bottom: 0px; position: relative; text-align: left; text-shadow: none; transform: none; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 18px; color: rgb(43, 43, 43); line-height: 2.4em; letter-spacing: 0em; margin-top: 38px; margin-bottom: 10px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: 38px; justify-content: unset; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; position: relative; text-align: center; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">生成Juniper防火墙映射公网对应端口列表</span><span class=\"suffix\" style=\"display: none;\"></span></h3> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(89, 89, 89); font-size: 14px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; font-weight: normal;\">\n    主要网络同事太懒，让帮忙给写脚本自动生成下对应映射ip和端口。 \n  </section></li> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(89, 89, 89); font-size: 14px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; font-weight: normal;\">\n    拿Juniper配置文件执行脚本生成，公网映射对应内网ip和端口 \n  </section></li> \n</ul> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#!/bin/bash</span><br>file=<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$1</span><br>outfile=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'PortMsg.csv'</span><br><br>Natid=$(grep&nbsp;&nbsp;destination-nat&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$file</span>&nbsp;|grep&nbsp;NATDST|awk&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$12}'</span>)<br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">for</span>&nbsp;id&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">in</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$Natid</span><br><span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#for&nbsp;id&nbsp;in&nbsp;nat10090ser190</span><br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">do</span><br>&nbsp;&nbsp;&nbsp;&nbsp;id=$(<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$id</span>|awk&nbsp;-F<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"\\r\"</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$1}'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;ruleId=$(grep&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"pool&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$id</span>\"</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$file</span>&nbsp;|grep&nbsp;&nbsp;rule-set&nbsp;|awk&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$7\"&nbsp;\"$8}'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;ruleId=$(<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$ruleId</span>|awk&nbsp;-F<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"\\r\"</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$1}'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#ruleId=$(echo&nbsp;$ruleId&nbsp;|sed&nbsp;&nbsp;s/\"&nbsp;rule\"/\"|rule&nbsp;\"/g)</span><br>&nbsp;&nbsp;&nbsp;&nbsp;ruleId=$(<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$ruleId</span>&nbsp;|&nbsp;&nbsp;&nbsp;sed&nbsp;&nbsp;s/<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"&nbsp;rule\"</span>/<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"|rule\"</span>/g&nbsp;|&nbsp;sed&nbsp;&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'s/|/&nbsp;|/'</span>g)<br>&nbsp;&nbsp;&nbsp;&nbsp;PublicIP=$(egrep&nbsp;&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$ruleId</span>&nbsp;match\"</span>&nbsp;&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$file</span>|grep&nbsp;&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"match&nbsp;destination-address\"</span>|awk&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$NF}'</span>|cut&nbsp;-d/&nbsp;-f1|sort|uniq)<br>&nbsp;&nbsp;&nbsp;&nbsp;PublicPort=$(egrep&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$ruleId</span>&nbsp;match\"</span>&nbsp;&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$file</span>|grep&nbsp;&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"match&nbsp;destination-port\"</span>|awk&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$NF}'</span>|cut&nbsp;-d/&nbsp;-f1|sort|uniq)<br>&nbsp;&nbsp;&nbsp;&nbsp;localIP=$(grep&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"pool&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$id</span>\"</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$file</span>&nbsp;|grep&nbsp;&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"destination&nbsp;pool\"</span>|grep&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'/'</span>|&nbsp;awk&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$NF}'</span>|cut&nbsp;-d/&nbsp;-f1)<br>&nbsp;&nbsp;&nbsp;&nbsp;localPort=$(grep&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"pool&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$id</span>\"</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$file</span>&nbsp;|grep&nbsp;&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"destination&nbsp;pool\"</span>|grep&nbsp;-v&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'/'</span>|&nbsp;awk&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$NF}'</span>|cut&nbsp;-d/&nbsp;-f1)<br>&nbsp;&nbsp;&nbsp;&nbsp;PublicIP=$(<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$PublicIP</span>|awk&nbsp;-F<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"\\r\"</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$1}'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;PublicPort=$(<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$PublicPort</span>|awk&nbsp;-F<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"\\r\"</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$1}'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;localIP=$(<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$localIP</span>|awk&nbsp;-F<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"\\r\"</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$1}'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;localPort=$(<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$localPort</span>|awk&nbsp;-F<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"\\r\"</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'{print&nbsp;$1}'</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$PublicIP</span>,<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$PublicPort</span>,<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$localIP</span>,<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$localPort</span>&nbsp;&gt;&gt;&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$outfile</span><br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">done</span><br><span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"create&nbsp;file&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$outfile</span>&nbsp;ok\"</span><br></code></pre> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(89, 89, 89); font-size: 14px; line-height: 1.8em; letter-spacing: 0.02em; text-align: left; font-weight: normal;\">\n    执行命令 \n  </section></li> \n</ul> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">##导出Juniper防火墙配置文件,需要转码下，不然grep无法过滤到数据。</span><br>[root@storager_node_1&nbsp;~]<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;file&nbsp;&nbsp;DSJZX-SRX340.txt&nbsp;</span><br>DSJZX-SRX340.txt:&nbsp;Little-endian&nbsp;UTF-16&nbsp;Unicode&nbsp;text,&nbsp;with&nbsp;CRLF&nbsp;line&nbsp;terminators<br>[root@storager_node_1&nbsp;~]<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;dos2unix&nbsp;&nbsp;DSJZX-SRX340.txt</span><br>dos2unix:&nbsp;converting&nbsp;file&nbsp;DSJZX-SRX340.txt&nbsp;to&nbsp;Unix&nbsp;format&nbsp;...<br>[root@storager_node_1&nbsp;~]<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;file&nbsp;&nbsp;DSJZX-SRX340.txt</span><br>DSJZX-SRX340.txt:&nbsp;ASCII&nbsp;text<br><br>[root@storager_node_1&nbsp;~]<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;./FormatPort.sh&nbsp;&nbsp;DSJZX-SRX340.txt&nbsp;</span><br>create&nbsp;file&nbsp;PortMsg.csv&nbsp;ok<br>[root@storager_node_1&nbsp;~]<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;more&nbsp;PortMsg.csv&nbsp;</span><br><span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#公网1、公网2,公网端口,内网ip,内网端口&nbsp;</span><br>22.22.22.22&nbsp;22.22.22.33,22125,192.168.127.22,22<br></code></pre>",
                "title": "生成Juniper防火墙映射公网对应端口列表",
                "categoryId": 1,
                "categoryName": "后端",
                "tagId": 179,
                "tagName": "运维部署",
                "userId": 55087,
                "userOutId": "954219099709",
                "username": "平凡的运维之路",
                "avatar": "",
                "description": "生成Juniper防火墙映射公网对应端口列表主要网络同事太懒，让帮忙给写脚本自动生成下对应映射ip和端口。拿Juniper配置文件执行脚本生成，公网映射对应内网ip和端口#!/bin/bashfile",
                "level": 1,
                "publishTime": "2024/10/22",
                "readingNum": 5,
                "likeNum": 0,
                "introduction": null,
                "followWords": null,
                "followPic": null,
                "isFollowing": false,
                "isLike": false,
                "isSelf": false,
                "type": 1,
                "isVisible": true,
                "invisibleReason": null,
                "writingColumn": {
                    "columnOutId": "6dfd419ade4543e7a4733b583779d42b",
                    "name": "默认专栏",
                    "briefIntro": "这是一个默认专栏",
                    "cover": "https://files.mdnice.com/common/community/default-column-cover.jpg",
                    "writingNum": 28,
                    "createTime": "2024-08-06 19:03"
                }
            }
        },
        "__N_SSP": true
    },
    "page": "/writing/[id]",
    "query": {
        "id": "f195340a3df24fd89f103de02c5047a7"
    },
    "buildId": "ErZPkD4oq6iwH2nj6Dpcx",
    "isFallback": false,
    "gssp": true,
    "appGip": true
}