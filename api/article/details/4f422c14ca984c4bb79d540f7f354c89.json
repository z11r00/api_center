{
    "props": {
        "pageProps": {
            "query": {
                "id": "4f422c14ca984c4bb79d540f7f354c89"
            },
            "ieBrowser": false,
            "needRefresh": false,
            "writingDetail": {
                "id": 86217,
                "outId": "4f422c14ca984c4bb79d540f7f354c89",
                "articleOutId": "4f422c14ca984c4bb79d540f7f354c89",
                "html": "<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">scanpy或squidpy没有专门针对10X HD数据的读取方法，分享给大家一个自用的函数用scanpy读取10X HD数据，并使用squidpy可视化。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">import</span>&nbsp;pandas&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">as</span>&nbsp;pd<br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">import</span>&nbsp;scanpy&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">as</span>&nbsp;sc<br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">import</span>&nbsp;squidpy&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">as</span>&nbsp;sq<br><br><span class=\"hljs-function\" style=\"line-height: 26px;\"><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">def</span>&nbsp;<span class=\"hljs-title\" style=\"color: #61aeee; line-height: 26px;\">read_HD</span><span class=\"hljs-params\" style=\"line-height: 26px;\">(data_dir)</span>:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;raw_h5_file&nbsp;=&nbsp;data_dir+<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'/filtered_feature_bc_matrix.h5'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;adata&nbsp;=&nbsp;sc.read_10x_h5(raw_h5_file)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;Load&nbsp;the&nbsp;Spatial&nbsp;Coordinates</span><br>&nbsp;&nbsp;&nbsp;&nbsp;tissue_position_file&nbsp;=&nbsp;data_dir+<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'/spatial/tissue_positions.parquet'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;df_tissue_positions=pd.read_table(tissue_position_file,&nbsp;sep=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\",\"</span>)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#Set&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;dataframe&nbsp;to&nbsp;the&nbsp;barcodes</span><br>&nbsp;&nbsp;&nbsp;&nbsp;df_tissue_positions&nbsp;=&nbsp;df_tissue_positions.set_index(<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'barcode'</span>)<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;Create&nbsp;an&nbsp;index&nbsp;in&nbsp;the&nbsp;dataframe&nbsp;to&nbsp;check&nbsp;joins</span><br>&nbsp;&nbsp;&nbsp;&nbsp;df_tissue_positions[<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'index'</span>]=df_tissue_positions.index<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;Adding&nbsp;the&nbsp;tissue&nbsp;positions&nbsp;to&nbsp;the&nbsp;meta&nbsp;data</span><br>&nbsp;&nbsp;&nbsp;&nbsp;adata.obs&nbsp;=&nbsp;&nbsp;pd.merge(adata.obs,&nbsp;df_tissue_positions,&nbsp;left_index=<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">True</span>,&nbsp;right_index=<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">True</span>)<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;adata.obsm[<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'spatial'</span>]&nbsp;=&nbsp;adata.obs[[<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"pxl_col_in_fullres\"</span>,&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"pxl_row_in_fullres\"</span>]].values<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">return</span>&nbsp;adata<br><br>data_dir&nbsp;=&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"/path/SpaceRanger_Count/Pancreas/outs/binned_outputs/square_016um/\"</span><br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">data_dir的路径下需要包涵下面的两个文件</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">.<br>├──&nbsp;filtered_feature_bc_matrix.h5<br>└──&nbsp;spatial<br>&nbsp;&nbsp;&nbsp;&nbsp;└──&nbsp;tissue_positions.parquet<br></code></pre> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">adata&nbsp;=&nbsp;read_HD(data_dir)<br>sc.pp.calculate_qc_metrics(<br>&nbsp;&nbsp;&nbsp;&nbsp;adata,&nbsp;inplace=<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">True</span>,&nbsp;log1p=<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">True</span><br>)<br><br>sq.pl.spatial_scatter(<br>&nbsp;&nbsp;&nbsp;&nbsp;adata,&nbsp;shape=<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">None</span>,&nbsp;color=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"n_genes_by_counts\"</span>,&nbsp;size=<span class=\"hljs-number\" style=\"color: #d19a66; line-height: 26px;\">0.5</span>,&nbsp;library_id=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"spatial\"</span>,&nbsp;figsize=(<span class=\"hljs-number\" style=\"color: #d19a66; line-height: 26px;\">7</span>,&nbsp;<span class=\"hljs-number\" style=\"color: #d19a66; line-height: 26px;\">5</span>)<br>)<br></code></pre> \n<figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: flex; flex-direction: column; justify-content: center; align-items: center;\"> \n <img src=\"https://files.mdnice.com/user/5058/55e1edcd-716c-4a55-8c0c-980f74214441.png\" alt style=\"display: block; margin-top: 0px; margin-right: auto; margin-bottom: 0px; margin-left: auto; max-width: 100%; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgba(0, 0, 0, 0.4); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; object-fit: fill; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px;\"> \n</figure> \n<h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 18px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 4px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 0px; padding-left: 0px; padding-right: 4px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">ref</span><span class=\"suffix\" style=\"display: none;\"></span></h2> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    https://www.10xgenomics.com/analysis-guides/segmentation-visium-hd \n  </section></li> \n</ul>",
                "title": "scanpy读取10X HD数据",
                "categoryId": 1,
                "categoryName": "后端",
                "tagId": 100,
                "tagName": "后端",
                "userId": 5058,
                "userOutId": "467349893823",
                "username": "苑赞",
                "avatar": "http://thirdwx.qlogo.cn/mmopen/ajNVdqHZLLC4WZukYSFTBoB10XAOPb4leLn2PHcmhJVL6Awne92f4LTWAK6tP0NVETtrp9k6TYzylPA2IaGK1g/132",
                "description": "scanpy或squidpy没有专门针对10XHD数据的读取方法，分享给大家一个自用的函数用scanpy读取10XHD数据，并使用squidpy可视化。import&nbsp;pandas&nbsp;",
                "level": 1,
                "publishTime": "2024/11/06",
                "readingNum": 3,
                "likeNum": 0,
                "introduction": null,
                "followWords": null,
                "followPic": null,
                "isFollowing": false,
                "isLike": false,
                "isSelf": false,
                "type": 1,
                "isVisible": true,
                "invisibleReason": null,
                "writingColumn": {
                    "columnOutId": "524feaa0f2804091b181e665174a6bd9",
                    "name": "默认专栏",
                    "briefIntro": "这是一个默认专栏",
                    "cover": "https://files.mdnice.com/common/community/default-column-cover.jpg",
                    "writingNum": 1,
                    "createTime": "2024-08-06 19:08"
                }
            }
        },
        "__N_SSP": true
    },
    "page": "/writing/[id]",
    "query": {
        "id": "4f422c14ca984c4bb79d540f7f354c89"
    },
    "buildId": "ErZPkD4oq6iwH2nj6Dpcx",
    "isFallback": false,
    "gssp": true,
    "appGip": true
}