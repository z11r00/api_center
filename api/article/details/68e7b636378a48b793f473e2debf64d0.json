{
    "props": {
        "pageProps": {
            "query": {
                "id": "68e7b636378a48b793f473e2debf64d0"
            },
            "ieBrowser": false,
            "needRefresh": false,
            "writingDetail": {
                "id": 83011,
                "outId": "68e7b636378a48b793f473e2debf64d0",
                "articleOutId": "68e7b636378a48b793f473e2debf64d0",
                "html": "<h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 18px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 4px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 0px; padding-left: 0px; padding-right: 4px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">环境说明</span><span class=\"suffix\" style=\"display: none;\"></span></h2> \n<blockquote class=\"multiquote-1\" data-tool=\"mdnice编辑器\" style=\"margin-top: 20px; margin-bottom: 20px; margin-left: 0px; margin-right: 0px; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; border-top-style: dashed; border-bottom-style: solid; border-left-style: dashed; border-right-style: dashed; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); border-left-color: rgb(37, 132, 181); border-right-color: rgb(37, 132, 181); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; background-attachment: scroll; background-clip: border-box; background-color: rgba(0, 0, 0, 0); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px; display: block; overflow-x: auto; overflow-y: auto;\"> <span style=\"display: none; color: rgb(0, 0, 0); font-size: 16px; line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: normal;\"></span> \n <p style=\"text-indent: 0em; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px; color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;\">企业内网环境，使用docker-compose的方式安装Harbor服务，需要先安装docker、docker-compose两个服务，将以二进制的方式安装docker和docker-compose，以适配各种安装环境。</p> \n</blockquote> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    docker版本：20.10.21，建议使用20.10以上的版本，低版本的会出现安装异常； \n  </section></li> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    Docker-compose版本：2.24.7 \n  </section></li> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    Harbor版本：2.10.3 \n  </section></li> \n</ul> \n<h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 18px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 4px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 0px; padding-left: 0px; padding-right: 4px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">一、编写ansible role</span><span class=\"suffix\" style=\"display: none;\"></span></h2> \n<h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"background-image: linear-gradient(45deg, transparent 48%, rgb(37, 132, 181) 48%, rgb(37, 132, 181) 52%, transparent 52%); align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; color: rgb(0, 0, 0); display: inline-block; font-size: 22px; font-weight: bold; flex-direction: unset; float: unset; height: 30px; justify-content: unset; letter-spacing: 0px; line-height: 1.5em; margin-top: 0px; margin-bottom: -11px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: 30px; -webkit-box-reflect: unset;\"></span><span class=\"content\" style=\"font-size: 16px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 2px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 2px; padding-left: 10px; padding-right: 10px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">1.1 初始化ansible role</span><span class=\"suffix\" style=\"display: none;\"></span></h3> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">使用<code style=\"color: rgb(37, 132, 181); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: 'Operator Mono', Consolas, Monaco, Menlo, monospace; word-break: break-all;\">ansible-galaxy init</code>命令初始化一个安装harbor的ansible role。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">$</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;ansible-galaxy&nbsp;init&nbsp;/etc/ansible/roles/harbor-install</span><br></code></pre> \n<h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"background-image: linear-gradient(45deg, transparent 48%, rgb(37, 132, 181) 48%, rgb(37, 132, 181) 52%, transparent 52%); align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; color: rgb(0, 0, 0); display: inline-block; font-size: 22px; font-weight: bold; flex-direction: unset; float: unset; height: 30px; justify-content: unset; letter-spacing: 0px; line-height: 1.5em; margin-top: 0px; margin-bottom: -11px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: 30px; -webkit-box-reflect: unset;\"></span><span class=\"content\" style=\"font-size: 16px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 2px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 2px; padding-left: 10px; padding-right: 10px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">1.2 设置环境变量</span><span class=\"suffix\" style=\"display: none;\"></span></h3> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">通过环境变量的方式自定义安装环境，使用时候修改对应环境变量的值即可。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">$</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;cat&nbsp;roles/harbor-install/vars/main.yml</span><br>---<br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;vars&nbsp;file&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">for</span>&nbsp;harbor-install</span><br>DOCKER_VERSION:&nbsp;\"20.10.21\"&nbsp;&nbsp;#docker服务版本<br>HARBOR_VERSION:&nbsp;2.10.3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#harbor服务版本<br>INSTALL_PATH:&nbsp;/app&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#安装目录<br>HTTP_PORT:&nbsp;8888&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#harbor服务端口(http)<br>HTTPS_PORT:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#harbor服务端口(https)<br>DATA_PATH:&nbsp;/app/data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#harbor数据目录，规划好大小<br></code></pre> \n<h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"background-image: linear-gradient(45deg, transparent 48%, rgb(37, 132, 181) 48%, rgb(37, 132, 181) 52%, transparent 52%); align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; color: rgb(0, 0, 0); display: inline-block; font-size: 22px; font-weight: bold; flex-direction: unset; float: unset; height: 30px; justify-content: unset; letter-spacing: 0px; line-height: 1.5em; margin-top: 0px; margin-bottom: -11px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: 30px; -webkit-box-reflect: unset;\"></span><span class=\"content\" style=\"font-size: 16px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 2px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 2px; padding-left: 10px; padding-right: 10px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">1.3 下载文件</span><span class=\"suffix\" style=\"display: none;\"></span></h3> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">因为考虑到企业内网环境，提前将对应版本的安装包下载好放到<code style=\"color: rgb(37, 132, 181); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: 'Operator Mono', Consolas, Monaco, Menlo, monospace; word-break: break-all;\">roles/harbor-install/files/</code>目录下。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">$</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;wget&nbsp;-c&nbsp;https://download.docker.com/linux/static/stable/x86_64/docker-20.10.21.tgz</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">$</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;wget&nbsp;-c&nbsp;https://github.com/docker/compose/releases/download/v2.24.7/docker-compose-linux-x86_64</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">$</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;wget&nbsp;-c&nbsp;https://github.com/goharbor/harbor/releases/download/v2.10.3/harbor-offline-installer-v2.10.3.tgz</span><br></code></pre> \n<h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"background-image: linear-gradient(45deg, transparent 48%, rgb(37, 132, 181) 48%, rgb(37, 132, 181) 52%, transparent 52%); align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; color: rgb(0, 0, 0); display: inline-block; font-size: 22px; font-weight: bold; flex-direction: unset; float: unset; height: 30px; justify-content: unset; letter-spacing: 0px; line-height: 1.5em; margin-top: 0px; margin-bottom: -11px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: 30px; -webkit-box-reflect: unset;\"></span><span class=\"content\" style=\"font-size: 16px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 2px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 2px; padding-left: 10px; padding-right: 10px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">1.4 创建服务启动文件</span><span class=\"suffix\" style=\"display: none;\"></span></h3> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">安装harbor时依赖docker和containerd两个服务，将服务启动文件写好放到<code style=\"color: rgb(37, 132, 181); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: 'Operator Mono', Consolas, Monaco, Menlo, monospace; word-break: break-all;\">role/harbor-install/files/</code>目录下。</p> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    创建containerd服务启动文件 \n  </section></li> \n</ul> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">$</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;cat&nbsp;role/harbor-install/files/containerd.service</span><br>[Unit]<br>Description=containerd&nbsp;container&nbsp;runtime<br>Documentation=https://containerd.io<br>After=network.target&nbsp;local-fs.target<br><br>[Service]<br>ExecStartPre=-/sbin/modprobe&nbsp;overlay<br>ExecStart=/usr/bin/containerd<br><br>Type=notify<br>Delegate=yes<br>KillMode=process<br>Restart=always<br>RestartSec=5<br>LimitNPROC=infinity<br>LimitCORE=infinity<br>LimitNOFILE=1048576<br>TasksMax=infinity<br>OOMScoreAdjust=-999<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    创建docker启动文件 \n  </section></li> \n</ul> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">$</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;cat&nbsp;role/harbor-install/files/docker.service</span><br>[Unit]<br>Description=Docker&nbsp;Application&nbsp;Container&nbsp;Engine<br>Documentation=https://docs.docker.com<br>After=network-online.target&nbsp;docker.socket&nbsp;firewalld.service&nbsp;containerd.service&nbsp;time-set.target<br>Wants=network-online.target&nbsp;containerd.service<br>Requires=docker.socket<br><br>[Service]<br>Type=notify<br>ExecStart=/usr/bin/dockerd&nbsp;-H&nbsp;fd://&nbsp;--containerd=/run/containerd/containerd.sock<br>ExecReload=/bin/kill&nbsp;-s&nbsp;HUP&nbsp;$MAINPID<br>TimeoutStartSec=0<br>RestartSec=2<br>Restart=always<br>StartLimitBurst=3<br>StartLimitInterval=60s<br>LimitNOFILE=infinity<br>LimitNPROC=infinity<br>LimitCORE=infinity<br>TasksMax=infinity<br>Delegate=yes<br>KillMode=process<br>OOMScoreAdjust=-500<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre> \n<figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: flex; flex-direction: column; justify-content: center; align-items: center;\"> \n <img src=\"https://files.mdnice.com/user/30944/b61cdd66-e0f6-4685-b1f3-9dba586fa763.png\" alt style=\"display: block; margin-top: 0px; margin-right: auto; margin-bottom: 0px; margin-left: auto; max-width: 100%; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgba(0, 0, 0, 0.4); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; object-fit: fill; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px;\"> \n</figure> \n<h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"background-image: linear-gradient(45deg, transparent 48%, rgb(37, 132, 181) 48%, rgb(37, 132, 181) 52%, transparent 52%); align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; color: rgb(0, 0, 0); display: inline-block; font-size: 22px; font-weight: bold; flex-direction: unset; float: unset; height: 30px; justify-content: unset; letter-spacing: 0px; line-height: 1.5em; margin-top: 0px; margin-bottom: -11px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: 30px; -webkit-box-reflect: unset;\"></span><span class=\"content\" style=\"font-size: 16px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 2px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 2px; padding-left: 10px; padding-right: 10px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">1.5 创建Harbor配置文件模块</span><span class=\"suffix\" style=\"display: none;\"></span></h3> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">使用<code style=\"color: rgb(37, 132, 181); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: 'Operator Mono', Consolas, Monaco, Menlo, monospace; word-break: break-all;\">jinjia2</code>模板文件来更具环境变量来自动生成Harbor的配置文件。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">$</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;cat&nbsp;/etc/ansible/roles/harbor-install/templates/harbor.yml.j2</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;Configuration&nbsp;file&nbsp;of&nbsp;Harbor</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\"><br>#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;The&nbsp;IP&nbsp;address&nbsp;or&nbsp;hostname&nbsp;to&nbsp;access&nbsp;admin&nbsp;UI&nbsp;and&nbsp;registry&nbsp;service.</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;DO&nbsp;NOT&nbsp;use&nbsp;localhost&nbsp;or&nbsp;127.0.0.1,&nbsp;because&nbsp;Harbor&nbsp;needs&nbsp;to&nbsp;be&nbsp;accessed&nbsp;by&nbsp;external&nbsp;clients.</span><br>hostname:&nbsp;{{&nbsp;ansible_host&nbsp;}}<br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\"><br>#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;http&nbsp;related&nbsp;config</span><br>http:<br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">&nbsp;&nbsp;#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;port&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">for</span>&nbsp;http,&nbsp;default&nbsp;is&nbsp;80.&nbsp;If&nbsp;https&nbsp;enabled,&nbsp;this&nbsp;port&nbsp;will&nbsp;redirect&nbsp;to&nbsp;https&nbsp;port</span><br>&nbsp;&nbsp;port:&nbsp;{{&nbsp;HTTP_PORT&nbsp;}}<br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\"><br>#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;https&nbsp;related&nbsp;config</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">https:</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">&nbsp;&nbsp;#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;https&nbsp;port&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">for</span>&nbsp;harbor,&nbsp;default&nbsp;is&nbsp;443</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">&nbsp;&nbsp;#</span><span class=\"bash\" style=\"line-height: 26px;\">port:&nbsp;443</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">&nbsp;&nbsp;#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;The&nbsp;path&nbsp;of&nbsp;cert&nbsp;and&nbsp;key&nbsp;files&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">for</span>&nbsp;nginx</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">&nbsp;&nbsp;#</span><span class=\"bash\" style=\"line-height: 26px;\">certificate:&nbsp;/your/certificate/path</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">&nbsp;&nbsp;#</span><span class=\"bash\" style=\"line-height: 26px;\">private_key:&nbsp;/your/private/key/path</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">&nbsp;&nbsp;#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">enable</span>&nbsp;strong&nbsp;ssl&nbsp;ciphers&nbsp;(default:&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">false</span>)</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">&nbsp;&nbsp;#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;strong_ssl_ciphers:&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">false</span></span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\"><br>#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;Uncomment&nbsp;following&nbsp;will&nbsp;enable&nbsp;tls&nbsp;communication&nbsp;between&nbsp;all&nbsp;harbor&nbsp;components</span></span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;internal_tls:</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;set&nbsp;enabled&nbsp;to&nbsp;true&nbsp;means&nbsp;internal&nbsp;tls&nbsp;is&nbsp;enabled</span></span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;&nbsp;&nbsp;enabled:&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">true</span></span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;put&nbsp;your&nbsp;cert&nbsp;and&nbsp;key&nbsp;files&nbsp;on&nbsp;dir</span></span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;&nbsp;&nbsp;dir:&nbsp;/etc/harbor/tls/internal</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\"><br><br>#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;Uncomment&nbsp;external_url&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">if</span>&nbsp;you&nbsp;want&nbsp;to&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">enable</span>&nbsp;external&nbsp;proxy</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;And&nbsp;when&nbsp;it&nbsp;enabled&nbsp;the&nbsp;hostname&nbsp;will&nbsp;no&nbsp;longer&nbsp;used</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;external_url:&nbsp;https://reg.mydomain.com:8433</span><br>external_url:&nbsp;http://{{&nbsp;ansible_host&nbsp;}}:{{&nbsp;HTTP_PORT&nbsp;}}<br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\"><br>#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;The&nbsp;initial&nbsp;password&nbsp;of&nbsp;Harbor&nbsp;admin</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;It&nbsp;only&nbsp;works&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">in</span>&nbsp;first&nbsp;time&nbsp;to&nbsp;install&nbsp;harbor</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;Remember&nbsp;Change&nbsp;the&nbsp;admin&nbsp;password&nbsp;from&nbsp;UI&nbsp;after&nbsp;launching&nbsp;Harbor.</span><br>harbor_admin_password:&nbsp;Harbor12345<br><br>...<br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">#</span><span class=\"bash\" style=\"line-height: 26px;\">以下内容根据实际情况调整，本处保持默认的配置。</span><br></code></pre> \n<hr data-tool=\"mdnice编辑器\" style=\"margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; border-top-style: solid; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(37, 132, 181); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; background-attachment: scroll; background-clip: border-box; background-color: rgba(0, 0, 0, 0); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: 1px;\"> \n<h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"background-image: linear-gradient(45deg, transparent 48%, rgb(37, 132, 181) 48%, rgb(37, 132, 181) 52%, transparent 52%); align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; color: rgb(0, 0, 0); display: inline-block; font-size: 22px; font-weight: bold; flex-direction: unset; float: unset; height: 30px; justify-content: unset; letter-spacing: 0px; line-height: 1.5em; margin-top: 0px; margin-bottom: -11px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: 30px; -webkit-box-reflect: unset;\"></span><span class=\"content\" style=\"font-size: 16px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 2px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 2px; padding-left: 10px; padding-right: 10px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">1.6 编写tasks文件</span><span class=\"suffix\" style=\"display: none;\"></span></h3> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">在<code style=\"color: rgb(37, 132, 181); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: 'Operator Mono', Consolas, Monaco, Menlo, monospace; word-break: break-all;\">main.yml</code>入口引用相关的tasks部署任务文件。 <img src=\"https://files.mdnice.com/user/30944/15492efd-e17c-48e8-ac29-78c9db5bcf1a.png\" alt style=\"display: block; margin-top: 0px; margin-right: auto; margin-bottom: 0px; margin-left: auto; max-width: 100%;\"></p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">$</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;cat&nbsp;roles/harbor-install/tasks/main.yml</span><br>---<br>-&nbsp;include_tasks:&nbsp;host-init.yml<br>-&nbsp;include_tasks:&nbsp;install-docker.yml<br>-&nbsp;include_tasks:&nbsp;harbor-install.yml<br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">1)编写主机初始化的tasks</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">$</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">cat</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">roles/harbor-install/tasks/host-init.yml</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">---</span><br><span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#主机初始化配置</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"关闭SELinux（临时）\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">selinux:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">state:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">disabled</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"关闭SELinux（永久）\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">lineinfile:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">path:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">/etc/selinux/config</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">regexp:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'^SELINUX='</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">line:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'SELINUX=disabled'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">create:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">yes</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"停止firewalld\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">service:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">firewalld</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">state:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">stopped</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">enabled:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">no</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">ignore_errors:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">yes</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"停止iptables\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">service:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">iptables</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">state:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">stopped</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">enabled:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">no</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">ignore_errors:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">yes</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"加载内核模块\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">shell:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">cmd:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"modprobe&nbsp;br_netfilter\"</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"设置内核参数（必须）\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">sysctl:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;item.key&nbsp;}}</span>\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">value:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;item.value&nbsp;}}</span>\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">sysctl_set:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">yes</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">state:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">present</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">reload:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">yes</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">loop:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">{</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">key:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'net.ipv4.ip_forward'</span><span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">,</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">value:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'1'</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">{</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">key:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'net.bridge.bridge-nf-call-iptables'</span><span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">,</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">value:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'1'</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">}</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">{</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">key:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'net.bridge.bridge-nf-call-ip6tables'</span><span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">,</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">value:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'1'</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">}</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"创建安装目录\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">file:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">path:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;INSTALL_PATH&nbsp;}}</span>\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">state:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">directory</span><br></code></pre> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    2）编写安装docker的tasks \n  </section></li> \n</ul> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">编写一个tasks任务，用于二进制安装containerd、docker和docker-compose服务。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">$</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">cat</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">roles/harbor-install/tasks/install-docker.yml</span>&nbsp;<br><span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#二进制方式安装docker-ce、docker-compose&nbsp;</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">---</span><br><span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#当docker命令返回非零状态码时，即未安装时执行安装docker任务</span><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"检查docker是否安装\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">shell:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">--version</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">register:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker_version</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">ignore_errors:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">true</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"若未安装docker则安装（二进制）\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">when:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker_version.rc</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">!=</span>&nbsp;<span class=\"hljs-number\" style=\"color: #d19a66; line-height: 26px;\">0</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">block:</span><br>&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"分发docker-ce离线二进制安装包\"</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">unarchive:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">src:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"docker-<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;DOCKER_VERSION&nbsp;}}</span>.tgz\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">dest:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;INSTALL_PATH&nbsp;}}</span>/\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">mode:</span>&nbsp;<span class=\"hljs-number\" style=\"color: #d19a66; line-height: 26px;\">0755</span><br><br>&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"复制二进制文件到/usr/bin/下\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">copy:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">src:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;INSTALL_PATH&nbsp;}}</span>/docker/<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;item&nbsp;}}</span>\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">dest:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"/usr/bin/\"</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">mode:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'0755'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">remote_src:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">yes</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">loop:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">containerd</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">containerd-shim</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">containerd-shim-runc-v2</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">ctr</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">dockerd</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker-init</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker-proxy</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">runc</span><br><br>&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"清理安装包\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">file:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">path:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;INSTALL_PATH&nbsp;}}</span>/docker\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">state:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">absent</span><br><br>&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#-&nbsp;name:&nbsp;\"分发docker配置文件\"</span><br>&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;&nbsp;copy:</span><br>&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;&nbsp;&nbsp;&nbsp;src:&nbsp;daemon.json</span><br>&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;&nbsp;&nbsp;&nbsp;dest:&nbsp;/etc/docker/</span><br>&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;&nbsp;&nbsp;&nbsp;mode:&nbsp;'0755'</span><br><br>&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"分发docker.socket文件（必需）\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">copy:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">dest:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">/usr/lib/systemd/system/docker.socket</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">mode:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'0644'</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">content:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">|<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Unit]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Description=Docker&nbsp;Socket&nbsp;for&nbsp;the&nbsp;API<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Socket]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ListenStream=/var/run/docker.sock<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SocketMode=0660<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SocketUser=root<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SocketGroup=docker<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Install]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WantedBy=sockets.target<br></span><br>&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"分发containerd服务启动文件\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">copy:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">src:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">containerd.service</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">dest:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">/usr/lib/systemd/system/containerd.service</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">mode:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'0644'</span><br><br>&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"分发docker服务启动文件\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">copy:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">src:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker.service</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">dest:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">/usr/lib/systemd/system/docker.service</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">mode:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'0644'</span><br><br>&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"创建docker用户组\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">group:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">state:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">present</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#system:&nbsp;yes</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#create_home:&nbsp;no</span><br>&nbsp;&nbsp;<br>&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"启动docker服务\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">service:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">state:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">started</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">enabled:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">yes</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">daemon_reload:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">yes</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"安装docker-compose（二进制）\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">copy:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">src:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker-compose-linux-x86_64</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">dest:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">/usr/local/bin/docker-compose</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">mode:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'0755'</span><br></code></pre> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    3）编写安装harbor的tasks文件 \n  </section></li> \n</ul> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">$</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">cat</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">roles/harbor-install/tasks/harbor-install.yml</span>&nbsp;<br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">---</span><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"创建数据目录\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">file:</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">path:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;DATA_PATH&nbsp;}}</span>\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">state:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">directory</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"分发离线安装包\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">unarchive:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">src:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"harbor-offline-installer-v<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;HARBOR_VERSION&nbsp;}}</span>.tgz\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">dest:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;INSTALL_PATH&nbsp;}}</span>\"</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"分发配置文件\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">template:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">src:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">harbor.yml.j2</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">dest:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;INSTALL_PATH&nbsp;}}</span>/harbor/harbor.yml\"</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"导入镜像&nbsp;&lt;docker&nbsp;load&nbsp;&nbsp;-i&nbsp;xxx.tar.gz&gt;\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">shell:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">cmd:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"docker&nbsp;load&nbsp;&nbsp;-i&nbsp;harbor.v<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;HARBOR_VERSION&nbsp;}}</span>.tar.gz&nbsp;\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">chdir:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;INSTALL_PATH&nbsp;}}</span>/harbor\"</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"将配置文件注入到组件中&nbsp;&lt;./prepare&gt;\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">shell:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">cmd:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"./prepare\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">chdir:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;INSTALL_PATH&nbsp;}}</span>/harbor\"</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"安装并启动服务&nbsp;&lt;./install.sh&nbsp;--with-trivy&gt;\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">shell:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">cmd:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"./install.sh&nbsp;--with-trivy\"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">chdir:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;INSTALL_PATH&nbsp;}}</span>/harbor\"</span><br><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">name:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"查看服务状态&lt;docker-compose&nbsp;ps&gt;\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">shell:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">cmd:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker-compose</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">ps</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">chdir:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;INSTALL_PATH&nbsp;}}</span>/harbor\"</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">register:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">docker_compose_output</span><br>&nbsp;<br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">debug:</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">msg:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-template-variable\" style=\"color: #d19a66; line-height: 26px;\">{{&nbsp;docker_compose_output.stdout&nbsp;}}</span>\"</span><br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">至此，部署harbor的ansible role编写就完成了，下面说明如何使用。</p> \n<h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 18px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 4px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 0px; padding-left: 0px; padding-right: 4px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">二、ansible部署Harbor</span><span class=\"suffix\" style=\"display: none;\"></span></h2> \n<blockquote class=\"multiquote-1\" data-tool=\"mdnice编辑器\" style=\"margin-top: 20px; margin-bottom: 20px; margin-left: 0px; margin-right: 0px; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; border-top-style: dashed; border-bottom-style: solid; border-left-style: dashed; border-right-style: dashed; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); border-left-color: rgb(37, 132, 181); border-right-color: rgb(37, 132, 181); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; background-attachment: scroll; background-clip: border-box; background-color: rgba(0, 0, 0, 0); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px; display: block; overflow-x: auto; overflow-y: auto;\"> <span style=\"display: none; color: rgb(0, 0, 0); font-size: 16px; line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: normal;\"></span> \n <p style=\"text-indent: 0em; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px; color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;\">使用前面创建好的ansible role来部署Harbor镜像仓库服务。</p> \n</blockquote> \n<h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"background-image: linear-gradient(45deg, transparent 48%, rgb(37, 132, 181) 48%, rgb(37, 132, 181) 52%, transparent 52%); align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; color: rgb(0, 0, 0); display: inline-block; font-size: 22px; font-weight: bold; flex-direction: unset; float: unset; height: 30px; justify-content: unset; letter-spacing: 0px; line-height: 1.5em; margin-top: 0px; margin-bottom: -11px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: 30px; -webkit-box-reflect: unset;\"></span><span class=\"content\" style=\"font-size: 16px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 2px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 2px; padding-left: 10px; padding-right: 10px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">2.1 创建ansible plabook</span><span class=\"suffix\" style=\"display: none;\"></span></h3> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">$</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">cat</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">Plabooks/harbor-deploy.yml</span><br><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">---</span><br><span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">hosts:</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">lidabai</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#指定部署Harbor的主机</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">become:</span>&nbsp;<span class=\"hljs-literal\" style=\"color: #56b6c2; line-height: 26px;\">yes</span><br>&nbsp;&nbsp;<span class=\"hljs-attr\" style=\"color: #d19a66; line-height: 26px;\">roles:</span><br>&nbsp;&nbsp;<span class=\"hljs-bullet\" style=\"color: #61aeee; line-height: 26px;\">-</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">harbor-install</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#调用安装harbor的ansible&nbsp;role</span><br></code></pre> \n<h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: block; flex-direction: unset; float: unset; height: auto; justify-content: unset; line-height: 1.5em; overflow-x: unset; overflow-y: unset; position: relative; text-align: left; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\"><span class=\"prefix\" style=\"background-image: linear-gradient(45deg, transparent 48%, rgb(37, 132, 181) 48%, rgb(37, 132, 181) 52%, transparent 52%); align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; color: rgb(0, 0, 0); display: inline-block; font-size: 22px; font-weight: bold; flex-direction: unset; float: unset; height: 30px; justify-content: unset; letter-spacing: 0px; line-height: 1.5em; margin-top: 0px; margin-bottom: -11px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: 30px; -webkit-box-reflect: unset;\"></span><span class=\"content\" style=\"font-size: 16px; color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); line-height: 1.5em; letter-spacing: 0em; align-items: unset; background-attachment: scroll; background-clip: border-box; background-color: transparent; background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; border-top-style: none; border-bottom-style: solid; border-left-style: none; border-right-style: none; border-top-width: 1px; border-bottom-width: 2px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(0, 0, 0); border-left-color: rgb(0, 0, 0); border-right-color: rgb(0, 0, 0); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-left-radius: 0px; border-bottom-right-radius: 0px; box-shadow: none; display: inline-block; font-weight: bold; flex-direction: unset; float: unset; height: auto; justify-content: unset; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; overflow-x: unset; overflow-y: unset; padding-top: 2px; padding-bottom: 2px; padding-left: 10px; padding-right: 10px; position: relative; text-align: left; text-indent: 0em; text-shadow: none; transform: none; width: auto; -webkit-box-reflect: unset;\">2.2 执行ansible plabook任务</span><span class=\"suffix\" style=\"display: none;\"></span></h3> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-meta\" style=\"color: #61aeee; line-height: 26px;\">$</span><span class=\"bash\" style=\"line-height: 26px;\">&nbsp;ansible-plabook&nbsp;Plabooks/harbor-deploy.yml</span><br>[root@lidabai-console&nbsp;ansible]#&nbsp;ansible-playbook&nbsp;Plabooks/harbor-deploy.yml<br><br>PLAY&nbsp;[lidabai]&nbsp;****************************************************************************************************************************************************<br><br>TASK&nbsp;[Gathering&nbsp;Facts]&nbsp;********************************************************************************************************************************************<br>ok:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;include_tasks]&nbsp;*****************************************************************************************************************************<br>included:&nbsp;/etc/ansible/roles/harbor-install/tasks/host-init.yml&nbsp;for&nbsp;192.168.2.201<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;关闭SELinux（临时）]&nbsp;*****************************************************************************************************************************<br>ok:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;关闭SELinux（永久）]&nbsp;*****************************************************************************************************************************<br>ok:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;停止firewalld]&nbsp;*******************************************************************************************************************************<br>fatal:&nbsp;[192.168.2.201]:&nbsp;FAILED!&nbsp;=&gt;&nbsp;{\"changed\":&nbsp;false,&nbsp;\"msg\":&nbsp;\"Could&nbsp;not&nbsp;find&nbsp;the&nbsp;requested&nbsp;service&nbsp;firewalld:&nbsp;host\"}<br>...ignoring<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;停止iptables]&nbsp;********************************************************************************************************************************<br>fatal:&nbsp;[192.168.2.201]:&nbsp;FAILED!&nbsp;=&gt;&nbsp;{\"changed\":&nbsp;false,&nbsp;\"msg\":&nbsp;\"Could&nbsp;not&nbsp;find&nbsp;the&nbsp;requested&nbsp;service&nbsp;iptables:&nbsp;host\"}<br>...ignoring<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;加载内核模块]&nbsp;************************************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;设置内核参数（必须）]&nbsp;********************************************************************************************************************************<br>ok:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item={u'value':&nbsp;u'1',&nbsp;u'key':&nbsp;u'net.ipv4.ip_forward'})<br>ok:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item={u'value':&nbsp;u'1',&nbsp;u'key':&nbsp;u'net.bridge.bridge-nf-call-iptables'})<br>ok:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item={u'value':&nbsp;u'1',&nbsp;u'key':&nbsp;u'net.bridge.bridge-nf-call-ip6tables'})<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;创建安装目录]&nbsp;************************************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;include_tasks]&nbsp;*****************************************************************************************************************************<br>included:&nbsp;/etc/ansible/roles/harbor-install/tasks/install-docker.yml&nbsp;for&nbsp;192.168.2.201<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;检查docker是否安装]&nbsp;******************************************************************************************************************************<br>fatal:&nbsp;[192.168.2.201]:&nbsp;FAILED!&nbsp;=&gt;&nbsp;{\"changed\":&nbsp;true,&nbsp;\"cmd\":&nbsp;\"docker&nbsp;--version\",&nbsp;\"delta\":&nbsp;\"0:00:00.018281\",&nbsp;\"end\":&nbsp;\"2024-08-16&nbsp;14:26:47.562401\",&nbsp;\"msg\":&nbsp;\"non-zero&nbsp;return&nbsp;code\",&nbsp;\"rc\":&nbsp;127,&nbsp;\"start\":&nbsp;\"2024-08-16&nbsp;14:26:47.544120\",&nbsp;\"stderr\":&nbsp;\"/bin/sh:&nbsp;docker:&nbsp;未找到命令\",&nbsp;\"stderr_lines\":&nbsp;[\"/bin/sh:&nbsp;docker:&nbsp;未找到命令\"],&nbsp;\"stdout\":&nbsp;\"\",&nbsp;\"stdout_lines\":&nbsp;[]}<br>...ignoring<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;分发docker-ce离线二进制安装包]&nbsp;***********************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;复制二进制文件到/usr/bin/下]&nbsp;************************************************************************************************************************<br>ok:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item=containerd)<br>ok:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item=containerd-shim)<br>ok:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item=containerd-shim-runc-v2)<br>ok:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item=ctr)<br>changed:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item=docker)<br>changed:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item=dockerd)<br>ok:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item=docker-init)<br>changed:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item=docker-proxy)<br>ok:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;(item=runc)<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;清理安装包]&nbsp;*************************************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;分发docker.socket文件（必需）]&nbsp;*********************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;分发containerd服务启动文件]&nbsp;************************************************************************************************************************<br>ok:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;分发docker服务启动文件]&nbsp;****************************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;创建docker用户组]&nbsp;*******************************************************************************************************************************<br>ok:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;启动docker服务]&nbsp;********************************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;安装docker-compose（二进制）]&nbsp;*********************************************************************************************************************<br>ok:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;include_tasks]&nbsp;*****************************************************************************************************************************<br>included:&nbsp;/etc/ansible/roles/harbor-install/tasks/harbor-install.yml&nbsp;for&nbsp;192.168.2.201<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;创建数据目录]&nbsp;************************************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;分发离线安装包]&nbsp;***********************************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;分发配置文件]&nbsp;************************************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;导入镜像&nbsp;&lt;docker&nbsp;load&nbsp;&nbsp;-i&nbsp;xxx.tar.gz&gt;]&nbsp;*********************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;将配置文件注入到组件中&nbsp;&lt;./prepare&gt;]&nbsp;*******************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;安装并启动服务&nbsp;&lt;./install.sh&nbsp;--with-trivy&gt;]&nbsp;*******************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;查看服务状态&lt;docker-compose&nbsp;ps&gt;]&nbsp;*****************************************************************************************************************<br>changed:&nbsp;[192.168.2.201]<br><br>TASK&nbsp;[harbor-install&nbsp;:&nbsp;debug]&nbsp;*************************************************************************************************************************************<br>ok:&nbsp;[192.168.2.201]&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;\"msg\":&nbsp;\"NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SERVICE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS\\nharbor-core&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\\"/harbor/entrypoint.…\\\"&nbsp;&nbsp;&nbsp;core&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;(starting)&nbsp;&nbsp;&nbsp;\\nharbor-db&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\\"/docker-entrypoint.…\\\"&nbsp;&nbsp;&nbsp;postgresql&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;(starting)&nbsp;&nbsp;&nbsp;\\nharbor-jobservice&nbsp;&nbsp;&nbsp;\\\"/harbor/entrypoint.…\\\"&nbsp;&nbsp;&nbsp;jobservice&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;restarting&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\nharbor-log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\\"/bin/sh&nbsp;-c&nbsp;/usr/loc…\\\"&nbsp;&nbsp;&nbsp;log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;(starting)&nbsp;&nbsp;&nbsp;127.0.0.1:1514-&gt;10514/tcp\\nharbor-portal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\\"nginx&nbsp;-g&nbsp;'daemon&nbsp;of…\\\"&nbsp;&nbsp;&nbsp;portal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;(starting)&nbsp;&nbsp;&nbsp;\\nnginx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\\"nginx&nbsp;-g&nbsp;'daemon&nbsp;of…\\\"&nbsp;&nbsp;&nbsp;proxy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;(starting)&nbsp;&nbsp;&nbsp;0.0.0.0:8021-&gt;8080/tcp,&nbsp;:::8021-&gt;8080/tcp\\nredis&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\\"redis-server&nbsp;/etc/r…\\\"&nbsp;&nbsp;&nbsp;redis&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;(starting)&nbsp;&nbsp;&nbsp;\\nregistry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\\"/home/harbor/entryp…\\\"&nbsp;&nbsp;&nbsp;registry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;(starting)&nbsp;&nbsp;&nbsp;\\nregistryctl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\\"/home/harbor/start.…\\\"&nbsp;&nbsp;&nbsp;registryctl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;(starting)&nbsp;&nbsp;&nbsp;\\ntrivy-adapter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\\"/home/scanner/entry…\\\"&nbsp;&nbsp;&nbsp;trivy-adapter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running&nbsp;(starting)&nbsp;&nbsp;&nbsp;\"<br>}<br><br>PLAY&nbsp;RECAP&nbsp;********************************************************************************************************************************************************<br>192.168.2.201&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;ok=29&nbsp;&nbsp;&nbsp;changed=16&nbsp;&nbsp;&nbsp;unreachable=0&nbsp;&nbsp;&nbsp;&nbsp;failed=0&nbsp;&nbsp;&nbsp;&nbsp;skipped=0&nbsp;&nbsp;&nbsp;&nbsp;rescued=0&nbsp;&nbsp;&nbsp;&nbsp;ignored=3&nbsp;&nbsp;&nbsp;<br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">部署完成！</p> \n<figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: flex; flex-direction: column; justify-content: center; align-items: center;\"> \n <img src=\"https://files.mdnice.com/user/30944/01c72094-b22c-430b-8fce-9a53ec145114.png\" alt style=\"display: block; margin-top: 0px; margin-right: auto; margin-bottom: 0px; margin-left: auto; max-width: 100%; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgba(0, 0, 0, 0.4); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; object-fit: fill; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px;\"> \n</figure> \n<blockquote class=\"multiquote-1\" data-tool=\"mdnice编辑器\" style=\"margin-top: 20px; margin-bottom: 20px; margin-left: 0px; margin-right: 0px; padding-top: 10px; padding-bottom: 10px; padding-left: 20px; padding-right: 10px; border-top-style: dashed; border-bottom-style: solid; border-left-style: dashed; border-right-style: dashed; border-top-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-width: 1px; border-top-color: rgb(37, 132, 181); border-bottom-color: rgb(37, 132, 181); border-left-color: rgb(37, 132, 181); border-right-color: rgb(37, 132, 181); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; background-attachment: scroll; background-clip: border-box; background-color: rgba(0, 0, 0, 0); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px; display: block; overflow-x: auto; overflow-y: auto;\"> <span style=\"display: none; color: rgb(0, 0, 0); font-size: 16px; line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: normal;\"></span> \n <p style=\"text-indent: 0em; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px; color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px;\"><strong style=\"color: rgb(37, 132, 181); font-weight: bold; background-attachment: scroll; background-clip: border-box; background-color: rgba(0, 0, 0, 0); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgba(0, 0, 0, 0.4); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px;\"><code style=\"color: rgb(37, 132, 181); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: 'Operator Mono', Consolas, Monaco, Menlo, monospace; word-break: break-all;\">Ps</code></strong>: 本篇文章提供word文档及写好的ansible role。 若部署过程遇到问题，可扫描下方二维码添加楼主(微信号：QiuTu703)好友咨询。</p> \n</blockquote> \n<figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: flex; flex-direction: column; justify-content: center; align-items: center;\"> \n <img src=\"https://files.mdnice.com/user/30944/99b7dce9-22b5-4efa-b7f4-3a69c24a0c28.jpg\" alt style=\"display: block; margin-top: 0px; margin-right: auto; margin-bottom: 0px; margin-left: auto; max-width: 100%; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgba(0, 0, 0, 0.4); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; object-fit: fill; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px;\"> \n</figure>",
                "title": "Ansible一键安装Harbor服务",
                "categoryId": 1,
                "categoryName": "后端",
                "tagId": 179,
                "tagName": "运维部署",
                "userId": 30944,
                "userOutId": "163563224468",
                "username": "李大白",
                "avatar": "",
                "description": "环境说明企业内网环境，使用docker-compose的方式安装Harbor服务，需要先安装docker、docker-compose两个服务，将以二进制的方式安装docker和docker-comp",
                "level": 1,
                "publishTime": "2024/09/02",
                "readingNum": 1,
                "likeNum": 0,
                "introduction": null,
                "followWords": null,
                "followPic": null,
                "isFollowing": false,
                "isLike": false,
                "isSelf": false,
                "type": 1,
                "isVisible": true,
                "invisibleReason": null,
                "writingColumn": {
                    "columnOutId": "f61669b8d8034986a9d95536c204c332",
                    "name": "默认专栏",
                    "briefIntro": "这是一个默认专栏",
                    "cover": "https://files.mdnice.com/common/community/default-column-cover.jpg",
                    "writingNum": 5,
                    "createTime": "2024-08-06 19:05"
                }
            }
        },
        "__N_SSP": true
    },
    "page": "/writing/[id]",
    "query": {
        "id": "68e7b636378a48b793f473e2debf64d0"
    },
    "buildId": "ErZPkD4oq6iwH2nj6Dpcx",
    "isFallback": false,
    "gssp": true,
    "appGip": true
}