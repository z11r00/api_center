{
    "props": {
        "pageProps": {
            "query": {
                "id": "167e58b67e614363aaeeb31f65ad6a7d"
            },
            "ieBrowser": false,
            "needRefresh": false,
            "writingDetail": {
                "id": 82800,
                "outId": "167e58b67e614363aaeeb31f65ad6a7d",
                "articleOutId": "167e58b67e614363aaeeb31f65ad6a7d",
                "html": "<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">前不久部门同事参与了一个关键客户的国产数据库Poc工作。从群里反馈的一些信息来看，难度还是比较大。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">我们知道，对于数据库国产改造，其实有几个比较大的难点，其中最让人头疼的无非就是存储过程之类的对象了。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">从同时提供的迁移报告来看，我认为可能是今年我们接触较为复杂的一个Oracle国产化改造项目之一了，这里跟大家分享分享。</p> \n<h1 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 24px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">2700+ 存储过程</span><span class=\"suffix\" style=\"display: none;\"></span></h1> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">首先我们来看看同时分享的MogDB MTK报告，这里我们截图并打码，分享一下部分数据截图：</p> \n<figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: flex; flex-direction: column; justify-content: center; align-items: center;\"> \n <img src=\"https://files.mdnice.com/user/57407/10922321-09b9-44af-a37d-76bab3ea7558.jpg\" alt style=\"display: block; margin-top: 0px; margin-right: auto; margin-bottom: 0px; margin-left: auto; max-width: 100%; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgba(0, 0, 0, 0.4); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; object-fit: fill; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px;\"> \n</figure> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">大家可以看到这个Oracle 数据库还是非常复杂的，有2747个存储过程。通过MogDB mtk工具进行迁移之后，我们可以看到只有188个存储过程迁移失败，也就是说这188个存储目前暂时无法通过MogDB mtk工具来实现代码的自动转换。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">实际上我们可以看到，这188个过程中，有37个存储过程在源库就是异常状态，那么去掉这37个，那么实际上迁移失败的可理解为只有188-37=151个存储过程。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">那么151/(2747-37)=5.5%; 也就是说我们通过MogDB mtk工具基本上实现了该数据库存储过程的94.5%的自动化迁移改造。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">换句话讲，大家也可以理解为这个版本的MogDB对于该用户数据库来讲，存储过程的兼容度在94.5%。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">同时我们可以发现这个库除了存储过程之外，还有206个函数，其中源库失效的有5个函数，一共还有13个函数迁移失败了。这样大致算一下，函数的迁移成功比例大约是93.6%。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">此外大家也可以看到对于视图的迁移改造，MogDB mtk也能很好的完成代码自动化改写，成功比例也在90%以上。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">比如对于引用到的一些自定义函数，MogDB暂不支持的方式，那么我们后续代码改写，基本上都可以实现100%的国产化改造，这里分享一下这个案例中的改写部分内容。</p> \n<h1 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 24px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">MogDB 自定义函数改写</span><span class=\"suffix\" style=\"display: none;\"></span></h1> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">++原Oracle函数<br>CREATE&nbsp;OR&nbsp;REPLACE&nbsp;TYPE&nbsp;UI_FI.TYPE_LIST_AGG&nbsp;AS&nbsp;OBJECT<br><br>(<br>&nbsp;&nbsp;&nbsp;&nbsp;TOTAL&nbsp;VARCHAR2(4000),<br>&nbsp;&nbsp;&nbsp;&nbsp;STATIC&nbsp;FUNCTION&nbsp;ODCIAGGREGATEINITIALIZE(SCTX&nbsp;IN&nbsp;OUT&nbsp;TYPE_LIST_AGG)&nbsp;RETURN&nbsp;NUMBER,<br>&nbsp;&nbsp;&nbsp;&nbsp;MEMBER&nbsp;FUNCTION&nbsp;ODCIAGGREGATEITERATE(SELF&nbsp;IN&nbsp;OUT&nbsp;TYPE_LIST_AGG,&nbsp;VALUE&nbsp;IN&nbsp;VARCHAR2)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;NUMBER,<br>&nbsp;&nbsp;&nbsp;&nbsp;MEMBER&nbsp;FUNCTION&nbsp;ODCIAGGREGATETERMINATE(SELF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;TYPE_LIST_AGG,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURNVALUE&nbsp;OUT&nbsp;VARCHAR2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLAGS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;NUMBER)&nbsp;RETURN&nbsp;NUMBER,<br>&nbsp;&nbsp;&nbsp;&nbsp;MEMBER&nbsp;FUNCTION&nbsp;ODCIAGGREGATEMERGE(SELF&nbsp;IN&nbsp;OUT&nbsp;TYPE_LIST_AGG,&nbsp;CTX2&nbsp;IN&nbsp;TYPE_LIST_AGG)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;NUMBER<br>);<br>/<br>CREATE&nbsp;OR&nbsp;REPLACE&nbsp;TYPE&nbsp;BODY&nbsp;UI_FI.TYPE_LIST_AGG&nbsp;IS<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;STATIC&nbsp;FUNCTION&nbsp;ODCIAGGREGATEINITIALIZE(SCTX&nbsp;IN&nbsp;OUT&nbsp;TYPE_LIST_AGG)&nbsp;RETURN&nbsp;NUMBER&nbsp;IS<br>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCTX&nbsp;:=&nbsp;TYPE_LIST_AGG(NULL);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;ODCICONST.SUCCESS;<br>&nbsp;&nbsp;&nbsp;&nbsp;END;<br>&nbsp;&nbsp;&nbsp;&nbsp;MEMBER&nbsp;FUNCTION&nbsp;ODCIAGGREGATEITERATE(SELF&nbsp;IN&nbsp;OUT&nbsp;TYPE_LIST_AGG,&nbsp;VALUE&nbsp;IN&nbsp;VARCHAR2)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;NUMBER&nbsp;IS<br>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELF.TOTAL&nbsp;:=&nbsp;SELF.TOTAL&nbsp;||&nbsp;VALUE;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;ODCICONST.SUCCESS;<br>&nbsp;&nbsp;&nbsp;&nbsp;END;<br>&nbsp;&nbsp;&nbsp;&nbsp;MEMBER&nbsp;FUNCTION&nbsp;ODCIAGGREGATETERMINATE(SELF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;TYPE_LIST_AGG,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURNVALUE&nbsp;OUT&nbsp;VARCHAR2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FLAGS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IN&nbsp;NUMBER)&nbsp;RETURN&nbsp;NUMBER&nbsp;IS<br>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURNVALUE&nbsp;:=&nbsp;SUBSTR(SELF.TOTAL,&nbsp;2);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;ODCICONST.SUCCESS;<br>&nbsp;&nbsp;&nbsp;&nbsp;END;<br>&nbsp;&nbsp;&nbsp;&nbsp;MEMBER&nbsp;FUNCTION&nbsp;ODCIAGGREGATEMERGE(SELF&nbsp;IN&nbsp;OUT&nbsp;TYPE_LIST_AGG,&nbsp;CTX2&nbsp;IN&nbsp;TYPE_LIST_AGG)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;NUMBER&nbsp;IS<br>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SELF.TOTAL&nbsp;:=&nbsp;SELF.TOTAL&nbsp;||&nbsp;CTX2.TOTAL;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURN&nbsp;ODCICONST.SUCCESS;<br>&nbsp;&nbsp;&nbsp;&nbsp;END;<br>END;<br>/<br><br>CREATE&nbsp;OR&nbsp;REPLACE&nbsp;FUNCTION&nbsp;UI_FI.F_CHANGE_COL_TO_ROW(INPUT&nbsp;VARCHAR2)&nbsp;RETURN&nbsp;VARCHAR2<br>&nbsp;&nbsp;&nbsp;&nbsp;PARALLEL_ENABLE<br>&nbsp;&nbsp;&nbsp;&nbsp;AGGREGATE&nbsp;USING&nbsp;UI_FI.TYPE_LIST_AGG;<br>/&nbsp;&nbsp;&nbsp;<br><br>++&nbsp;MogDB&nbsp;改写的函数<br><br>CREATE&nbsp;OR&nbsp;REPLACE&nbsp;FUNCTION&nbsp;ui_fi.F_CHANGE_COL_TO_ROW_state_func&nbsp;(results&nbsp;VARCHAR2,&nbsp;val&nbsp;VARCHAR2)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;VARCHAR2<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LANGUAGE&nbsp;sql&nbsp;COST&nbsp;50&nbsp;IMMUTABLE<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AS&nbsp;$$&nbsp;select&nbsp;results&nbsp;||&nbsp;val;&nbsp;$$;<br><br>CREATE&nbsp;OR&nbsp;REPLACE&nbsp;FUNCTION&nbsp;ui_fi.F_CHANGE_COL_TO_ROW_final_func&nbsp;(results&nbsp;VARCHAR2)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RETURNS&nbsp;VARCHAR2<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LANGUAGE&nbsp;sql&nbsp;COST&nbsp;111&nbsp;IMMUTABLE<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AS&nbsp;$$&nbsp;select&nbsp;substr(results,&nbsp;2)::VARCHAR2;&nbsp;$$;<br><br>CREATE&nbsp;AGGREGATE&nbsp;ui_fi.F_CHANGE_COL_TO_ROW(VARCHAR2)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sfunc&nbsp;=&nbsp;ui_fi.F_CHANGE_COL_TO_ROW_state_func,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stype&nbsp;=&nbsp;VARCHAR2,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initcond&nbsp;=&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">''</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FINALFUNC&nbsp;=&nbsp;ui_fi.F_CHANGE_COL_TO_ROW_final_func<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br><br><br></code></pre> \n<h1 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 24px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">MogDB pipeline函数改写</span><span class=\"suffix\" style=\"display: none;\"></span></h1> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">这里我们完全仿照了客户生产环境代码的相关功能，给一个测试用例，具体生产代码就补贴了。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">++&nbsp;Oracle端<br><br>create&nbsp;TABLE&nbsp;t_test_pipeline(c1&nbsp;varchar2(20),c2&nbsp;number);<br><br>create&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">type</span>&nbsp;ty_test_pipeline&nbsp;as&nbsp;object(c1&nbsp;varchar2(20),c2&nbsp;number);<br>/<br>create&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">type</span>&nbsp;tyt_test_pipeline&nbsp;as&nbsp;table&nbsp;of&nbsp;ty_test_pipeline;<br>/<br><br>create&nbsp;or&nbsp;replace&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">function</span>&nbsp;f_test_pipeline(i&nbsp;number)&nbsp;<br><span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">return</span>&nbsp;tyt_test_pipeline&nbsp;--table&nbsp;of&nbsp;类型<br>PIPELINED&nbsp;is<br>&nbsp;PRAGMA&nbsp;AUTONOMOUS_TRANSACTION;&nbsp;--自治事务<br>&nbsp;TYPE&nbsp;CUR1&nbsp;IS&nbsp;REF&nbsp;CURSOR;<br>&nbsp;MYCURSOR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CUR1;<br>&nbsp;SQL_1&nbsp;VARCHAR2(4000);<br>&nbsp;SQL_2&nbsp;VARCHAR2(4000);<br>&nbsp;OUT_REC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ty_test_pipeline&nbsp;:=&nbsp;ty_test_pipeline(NULL,NULL);--构造空对象<br>begin&nbsp;<br>&nbsp;EXECUTE&nbsp;IMMEDIATE&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'TRUNCATE&nbsp;TABLE&nbsp;t_test_pipeline'</span>;&nbsp;--有truncate&nbsp;table&nbsp;注意ddl&nbsp;自动commit的行为<br>insert&nbsp;into&nbsp;t_test_pipeline&nbsp;values&nbsp;(<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'a'</span>,1);<br>insert&nbsp;into&nbsp;t_test_pipeline&nbsp;values&nbsp;(<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'b'</span>,2);<br>insert&nbsp;into&nbsp;t_test_pipeline&nbsp;values&nbsp;(<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'c'</span>,2);--模拟两行以上数据<br>insert&nbsp;into&nbsp;t_test_pipeline&nbsp;values&nbsp;(<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'d'</span>,2);<br>commit;&nbsp;&nbsp;--有commit<br>SQL_1:=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'SELECT&nbsp;*&nbsp;FROM&nbsp;t_test_pipeline&nbsp;WHERE&nbsp;C2=1'</span>;<br>SQL_2:=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'SELECT&nbsp;*&nbsp;FROM&nbsp;t_test_pipeline&nbsp;WHERE&nbsp;C2=2'</span>;<br><br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">if</span>&nbsp;i&nbsp;=1&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">then</span>&nbsp;&nbsp;--判断逻辑，打开不同的游标<br>&nbsp;OPEN&nbsp;MYCURSOR&nbsp;FOR&nbsp;SQL_1;<br>&nbsp;ELSE<br>&nbsp;OPEN&nbsp;MYCURSOR&nbsp;FOR&nbsp;SQL_2;<br>end&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">if</span>;<br><br>&nbsp;LOOP<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FETCH&nbsp;MYCURSOR<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTO&nbsp;OUT_REC.C1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OUT_REC.C2;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXIT&nbsp;WHEN&nbsp;MYCURSOR%NOTFOUND;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PIPE&nbsp;ROW(OUT_REC);<br>&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;LOOP;<br>&nbsp;&nbsp;&nbsp;&nbsp;CLOSE&nbsp;MYCURSOR;<br>&nbsp;&nbsp;&nbsp;&nbsp;RETURN;<br>end;<br>/<br><br>--调用<br>SELECT&nbsp;*&nbsp;FROM&nbsp;TABLE(f_test_pipeline(1));<br><br>SELECT&nbsp;*&nbsp;FROM&nbsp;TABLE(f_test_pipeline(2));<br><br>++&nbsp;MogDB&nbsp;改写后<br><br>create&nbsp;TABLE&nbsp;t_test_pipeline(c1&nbsp;varchar2(20),c2&nbsp;number);<br><br>create&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">type</span>&nbsp;ty_test_pipeline&nbsp;as&nbsp;object(c1&nbsp;varchar2(20),c2&nbsp;number);<br>/<br>create&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">type</span>&nbsp;tyt_test_pipeline&nbsp;as&nbsp;table&nbsp;of&nbsp;ty_test_pipeline;<br>/<br>create&nbsp;or&nbsp;replace&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">function</span>&nbsp;f_test_pipeline(i&nbsp;number)&nbsp;<br><span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">return</span>&nbsp;&nbsp;tyt_test_pipeline&nbsp;--table&nbsp;of&nbsp;类型<br>&nbsp;is<br>&nbsp;PRAGMA&nbsp;AUTONOMOUS_TRANSACTION;&nbsp;--自治事务<br>&nbsp;TYPE&nbsp;CUR1&nbsp;IS&nbsp;REF&nbsp;CURSOR;<br>&nbsp;MYCURSOR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CUR1;<br>&nbsp;SQL_1&nbsp;VARCHAR2(4000);<br>&nbsp;SQL_2&nbsp;VARCHAR2(4000);<br>&nbsp;OUT_TABLE&nbsp;tyt_test_pipeline;<br>begin&nbsp;<br>&nbsp;EXECUTE&nbsp;IMMEDIATE&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'TRUNCATE&nbsp;TABLE&nbsp;t_test_pipeline'</span>;&nbsp;--有truncate&nbsp;table&nbsp;注意ddl&nbsp;自动commit的行为<br>insert&nbsp;into&nbsp;t_test_pipeline&nbsp;values&nbsp;(<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'a'</span>,1);<br>insert&nbsp;into&nbsp;t_test_pipeline&nbsp;values&nbsp;(<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'b'</span>,1);<br>insert&nbsp;into&nbsp;t_test_pipeline&nbsp;values&nbsp;(<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'c'</span>,2);--模拟两行以上数据<br>insert&nbsp;into&nbsp;t_test_pipeline&nbsp;values&nbsp;(<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'d'</span>,2);<br>commit;&nbsp;&nbsp;--有commit<br>SQL_1:=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'SELECT&nbsp;*&nbsp;FROM&nbsp;t_test_pipeline&nbsp;WHERE&nbsp;C2=1'</span>;<br>SQL_2:=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'SELECT&nbsp;*&nbsp;FROM&nbsp;t_test_pipeline&nbsp;WHERE&nbsp;C2=2'</span>;<br><br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">if</span>&nbsp;i&nbsp;=1&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">then</span>&nbsp;&nbsp;--判断逻辑，打开不同的游标<br>&nbsp;OPEN&nbsp;MYCURSOR&nbsp;FOR&nbsp;SQL_1;<br>&nbsp;ELSE<br>&nbsp;OPEN&nbsp;MYCURSOR&nbsp;FOR&nbsp;SQL_2;<br>end&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">if</span>;<br><br>&nbsp;fetch&nbsp;MYCURSOR&nbsp;bulk&nbsp;collect&nbsp;into&nbsp;OUT_TABLE;--将循环fetch改成了一次性fetch<br>&nbsp;CLOSE&nbsp;MYCURSOR;<br><span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">return</span>&nbsp;OUT_TABLE;<br>end;<br>/<br>--调用<br>SELECT&nbsp;*&nbsp;FROM&nbsp;TABLE(f_test_pipeline(1));<br><br>SELECT&nbsp;*&nbsp;FROM&nbsp;TABLE(f_test_pipeline(2));<br><br><br></code></pre> \n<h1 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 24px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">关于MogDB MTK迁移工具</span><span class=\"suffix\" style=\"display: none;\"></span></h1> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">MTK全称为 Database Migration Toolkit，是一个可以将Oracle/DB2/MySQL/openGauss/SqlServer/Informix数据库的数据结构，全量数据高速导入到MogDB的工具。 最新版本同时支持对于Oracle/MySQL/DB2数据库中存储过程，函数，触发器等程序段的MogDB兼容性改写和导入。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">多数据库类型支持</p> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    支持 Oracle,DB2,SqlServer,MySQL,Informix,PostgreSQL 到MogDB数据库的迁移。 \n  </section></li> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    支持将数据库内容导出成可执行的 SQL 脚本 （源数据库内容迁移到文本）。 \n  </section></li> \n</ul> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">迁移性能调整</p> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    支持调整数据迁移过程中的批量查询、批量插入大小等细粒度参数，来调整数据迁移的性能。 \n  </section></li> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    支持数据迁移时的多并发，并行和数据分片。 \n  </section></li> \n</ul> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">结构和数据分离</p> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    支持迁移对象结构和数据；也支持仅迁移结构或者仅迁移数据（在结构已经迁移完之后）。 \n  </section></li> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    支持表级和 Schema 级的迁移范围限定，允许指定schema下全部对象或者某些对象进行迁移 。 \n  </section></li> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    支持迁移过程中的 Schema 重映射，也就是支持将对象从源Schema迁移到目标端的不同名Schema下 。 \n  </section></li> \n</ul> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">程序迁移</p> \n<ul data-tool=\"mdnice编辑器\" style=\"list-style-type: disc; margin-top: 8px; margin-bottom: 8px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 25px; padding-right: 0px; color: rgb(0, 0, 0);\"> \n <li> \n  <section style=\"margin-top: 5px; margin-bottom: 5px; color: rgb(1, 1, 1); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; font-weight: normal;\">\n    支持Oracle/MySQL/DB2到MogDB/openGauss的存储过程，函数，触发器，包迁移并对语法进行改写。 \n  </section></li> \n</ul> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">迁移场景</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">源数据库&nbsp;目标数据库<br>Oracle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MogDB<br>Oracle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;openGauss<br>Oracle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MySQL<br>Oracle&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostgreSQL<br>MySQL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MogDB<br>MySQL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;openGauss<br>MySQL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostgreSQL<br>DB2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MogDB<br>DB2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;openGauss<br>DB2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MySQL<br>DB2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostgreSQL<br>SqlServer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MogDB<br>SqlServer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;openGauss<br>SqlServer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MySQL<br>SqlServer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PostgreSQL<br>PostgreSQL&nbsp;&nbsp;&nbsp;MogDB<br>PostgreSQL&nbsp;&nbsp;&nbsp;openGauss<br>Informix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MogDB<br>Informix&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;openGauss<br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">参考：https://docs.mogdb.io/zh/mtk/v2.0/overview</p>",
                "title": "2700+存储过程的超复杂Oracle，国产化怎么办？",
                "categoryId": 1,
                "categoryName": "后端",
                "tagId": 170,
                "tagName": "数据库",
                "userId": 57407,
                "userOutId": "479919747659",
                "username": "lizhenxu007",
                "avatar": "https://files.mdnice.com/pic/3d17b156-d245-4cc1-b20f-86262ec15a54.png",
                "description": "前不久部门同事参与了一个关键客户的国产数据库Poc工作。从群里反馈的一些信息来看，难度还是比较大。我们知道，对于数据库国产改造，其实有几个比较大的难点，其中最让人头疼的无非就是存储过程之类的对象了。从",
                "level": 1,
                "publishTime": "2024/08/29",
                "readingNum": 3,
                "likeNum": 0,
                "introduction": null,
                "followWords": null,
                "followPic": null,
                "isFollowing": false,
                "isLike": false,
                "isSelf": false,
                "type": 1,
                "isVisible": true,
                "invisibleReason": null,
                "writingColumn": {
                    "columnOutId": "59257a23a7e942389e4cf3aab40948a1",
                    "name": "默认专栏",
                    "briefIntro": "这是一个默认专栏",
                    "cover": "https://files.mdnice.com/common/community/default-column-cover.jpg",
                    "writingNum": 24,
                    "createTime": "2024-08-06 19:03"
                }
            }
        },
        "__N_SSP": true
    },
    "page": "/writing/[id]",
    "query": {
        "id": "167e58b67e614363aaeeb31f65ad6a7d"
    },
    "buildId": "ErZPkD4oq6iwH2nj6Dpcx",
    "isFallback": false,
    "gssp": true,
    "appGip": true
}