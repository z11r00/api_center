{
    "props": {
        "pageProps": {
            "query": {
                "id": "d3eaf40cce794d529876708add808b8a"
            },
            "ieBrowser": false,
            "needRefresh": false,
            "writingDetail": {
                "id": 85598,
                "outId": "d3eaf40cce794d529876708add808b8a",
                "articleOutId": "d3eaf40cce794d529876708add808b8a",
                "html": "<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">昨天收到读者私信，想让我分析下某天涨停后次日涨跌幅， 以及后续表现情况。这个需求不算太复杂，简单实现下</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">先看下实现效果：</p> \n<figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: flex; flex-direction: column; justify-content: center; align-items: center;\"> \n <img src=\"https://files.mdnice.com/user/55218/4740cd32-36c6-4dc5-873c-6991dfd06499.png\" alt style=\"display: block; margin-top: 0px; margin-right: auto; margin-bottom: 0px; margin-left: auto; max-width: 100%; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgba(0, 0, 0, 0.4); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; object-fit: fill; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px;\"> \n</figure> \n<figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: flex; flex-direction: column; justify-content: center; align-items: center;\"> \n <img src=\"https://files.mdnice.com/user/55218/b68264b5-d96f-41b7-b14c-15086c0e7d10.png\" alt style=\"display: block; margin-top: 0px; margin-right: auto; margin-bottom: 0px; margin-left: auto; max-width: 100%; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgba(0, 0, 0, 0.4); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; object-fit: fill; box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px;\"> \n</figure> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">不用解释，直接上完整代码吧：</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">import streamlit as st import pandas as pd import plotly.graph_objects as go import tushare as ts import pywencai from datetime import datetime, timedelta</p> \n<h1 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 24px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">Initialize Tushare with your token</span><span class=\"suffix\" style=\"display: none;\"></span></h1> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">ts.set_token('Tushare with your token') pro = ts.pro_api()</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">def get_limit_up_stocks(date): query = f\"{date}涨停\" df = pywencai.get(query=query, sort_key='涨跌幅', sort_order='desc') return df[['股票代码', '股票简称', '最新价', '最新涨跌幅']]</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">def get_next_trading_day(date): next_day = (datetime.strptime(date, '%Y%m%d') + timedelta(days=1)).strftime('%Y%m%d') while True: df = pro.trade_cal(exchange='', start_date=next_day, end_date=next_day) if df.iloc[0]['is_open'] == 1: return next_day next_day = (datetime.strptime(next_day, '%Y%m%d') + timedelta(days=1)).strftime('%Y%m%d')</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">def get_stock_data(stock_code, start_date, end_date): df = pro.daily(ts_code=stock_code, start_date=start_date, end_date=end_date) df['trade_date'] = pd.to_datetime(df['trade_date']) df = df.sort_values('trade_date') return df</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">def calculate_next_day_performance(limit_up_stocks, date): next_trading_day = get_next_trading_day(date)</p> \n<pre data-tool=\"mdnice编辑器\"><code>results = []\nfor _, row in limit_up_stocks.iterrows():\n    stock_code = row['股票代码']\n    stock_name = row['股票简称']\n\n    df = get_stock_data(stock_code, date, next_trading_day)\n\n    if len(df) &gt;= 2:\n        limit_up_price = df.iloc[0]['close']\n        next_day_price = df.iloc[1]['close']\n        change_pct = (next_day_price - limit_up_price) / limit_up_price * 100\n\n        results.append({\n            '股票代码': stock_code,\n            '股票简称': stock_name,\n            '涨停价': limit_up_price,\n            '次日收盘价': next_day_price,\n            '次日涨跌幅': change_pct\n        })\n\nreturn pd.DataFrame(results)\n</code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">def display_stock_analysis(stock_code, selected_date): # Date range for data end_date = (datetime.now() + timedelta(days=1)).strftime('%Y%m%d') start_date = (datetime.strptime(selected_date, '%Y%m%d') - timedelta(days=60)).strftime('%Y%m%d')</p> \n<pre data-tool=\"mdnice编辑器\"><code># Fetch stock data\ndf = get_stock_data(stock_code, start_date, end_date)\n\nif not df.empty:\n    # Convert selected_date to datetime for comparison\n    selected_datetime = pd.to_datetime(selected_date)\n\n    # Create stock trend chart\n    fig = go.Figure()\n\n    # Add candlestick chart with red for positive changes and green for negative changes\n    fig.add_trace(go.Candlestick(\n        x=df['trade_date'],\n        open=df['open'],\n        high=df['high'],\n        low=df['low'],\n        close=df['close'],\n        increasing_line_color='red',  # Red for positive changes\n        decreasing_line_color='green',  # Green for negative changes\n        name=\"股价\"\n    ))\n\n    # Add marker for selected date\n    selected_price = df[df['trade_date'] == selected_datetime]['close'].values[0]\n    fig.add_trace(go.Scatter(\n        x=[selected_datetime],\n        y=[selected_price],\n        mode='markers',\n        marker=dict(size=10, color='blue', symbol='star'),\n        name=\"选择日期\"\n    ))\n\n    # Update layout\n    fig.update_layout(\n        title=f\"{stock_code} 近期走势\",\n        xaxis_title=\"日期\",\n        yaxis_title=\"价格\",\n        xaxis_rangeslider_visible=False,\n        plot_bgcolor='white',\n        paper_bgcolor='white',\n    )\n\n    st.plotly_chart(fig)\nelse:\n    st.error(\"无法获取股票数据，请检查股票代码是否正确。\")\n</code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">def main(): st.title(\"涨停股票分析\")</p> \n<pre data-tool=\"mdnice编辑器\"><code># Date selection with default set to October 8, 2024\ndefault_date = datetime(2024, 10, 8).date()\nselected_date = st.date_input(\"选择日期\", value=default_date, min_value=datetime(2020, 1, 1).date(),\n                              max_value=datetime.now().date())\ndate_str = selected_date.strftime('%Y%m%d')\n\n# Fetch limit-up stocks\nlimit_up_stocks = get_limit_up_stocks(date_str)\n\n# Calculate next day performance\nnext_day_performance = calculate_next_day_performance(limit_up_stocks, date_str)\n\n# Display limit-up stocks table with next day performance\nst.subheader(f\"{date_str} 涨停股票及次日表现\")\n\n# Custom styling function for the dataframe\ndef style_negative(v, props=''):\n    return props if v &lt; 0 else None\n\ndef style_positive(v, props=''):\n    return props if v &gt; 0 else None\n\n# Apply the styling to the dataframe\nstyled_df = next_day_performance.style.format({\n    '涨停价': '{:.2f}',\n    '次日收盘价': '{:.2f}',\n    '次日涨跌幅': '{:.2f}%'\n}).applymap(style_negative, props='color:green;', subset=['次日涨跌幅']) \\\n    .applymap(style_positive, props='color:red;', subset=['次日涨跌幅'])\n\nst.dataframe(styled_df)\n\n# Stock selection for detailed analysis\nselected_stock = st.selectbox(\"选择股票进行详细分析\",\n                              next_day_performance['股票代码'] + ' - ' + next_day_performance['股票简称'])\n\nif selected_stock:\n    stock_code = selected_stock.split(' - ')[0]\n    display_stock_analysis(stock_code, date_str)\n</code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">if <strong style=\"color: rgb(0, 0, 0); font-weight: bold; background-attachment: scroll; background-clip: border-box; background-color: rgba(0, 0, 0, 0); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgba(0, 0, 0, 0.4); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px;\">name</strong> == \"<strong style=\"color: rgb(0, 0, 0); font-weight: bold; background-attachment: scroll; background-clip: border-box; background-color: rgba(0, 0, 0, 0); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgba(0, 0, 0, 0.4); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px;\">main</strong>\":</p> \n<pre data-tool=\"mdnice编辑器\"><code>main()\n</code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">默认时间我设置20241008， 防止后续没有交易日数据。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">使用方法：</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">1、确保安装了所有必需的库：</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">pip install streamlit pandas plotly tushare pywencai</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">2、将'YOUR_TUSHARE_TOKEN'替换为你的实际Tushare API令牌。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">将代码保存到文件（例如<code style=\"color: rgb(30, 107, 184); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all;\">limit_up_analysis.py</code>）。</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">运行Streamlit应用：</p> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">streamlit run limit_up_analysis.py</p>",
                "title": "【Python技术】利用tushare、wencai分析某天涨停股票次日涨跌幅情况",
                "categoryId": 1,
                "categoryName": "后端",
                "tagId": 103,
                "tagName": "Python",
                "userId": 55218,
                "userOutId": "179427763817",
                "username": "子晓聊技术",
                "avatar": "https://files.mdnice.com/user/55218/user-avatar/5fc0cb71-d7f6-40e1-aec2-23fee5805e47.jpg",
                "description": "昨天收到读者私信，想让我分析下某天涨停后次日涨跌幅，以及后续表现情况。这个需求不算太复杂，简单实现下先看下实现效果：不用解释，直接上完整代码吧：importstreamlitasstimportpan",
                "level": 1,
                "publishTime": "2024/10/25",
                "readingNum": 9,
                "likeNum": 0,
                "introduction": "程序员，分享AI、JAVA、Python",
                "followWords": "扫码添加好友",
                "followPic": "https://files.mdnice.com/user/55218/follow/4a2b995c-733f-473b-8738-4b1a7c8432bf.jpg",
                "isFollowing": false,
                "isLike": false,
                "isSelf": false,
                "type": 1,
                "isVisible": true,
                "invisibleReason": null,
                "writingColumn": {
                    "columnOutId": "7617af3560d946f1b0782e88278ac9b6",
                    "name": "默认专栏",
                    "briefIntro": "这是一个默认专栏",
                    "cover": "https://files.mdnice.com/common/community/default-column-cover.jpg",
                    "writingNum": 4,
                    "createTime": "2024-08-06 19:03"
                }
            }
        },
        "__N_SSP": true
    },
    "page": "/writing/[id]",
    "query": {
        "id": "d3eaf40cce794d529876708add808b8a"
    },
    "buildId": "ErZPkD4oq6iwH2nj6Dpcx",
    "isFallback": false,
    "gssp": true,
    "appGip": true
}