{
    "props": {
        "pageProps": {
            "query": {
                "id": "ec3dbe62e02a42fc9fa4525666d5052e"
            },
            "ieBrowser": false,
            "needRefresh": false,
            "writingDetail": {
                "id": 86202,
                "outId": "ec3dbe62e02a42fc9fa4525666d5052e",
                "articleOutId": "ec3dbe62e02a42fc9fa4525666d5052e",
                "html": "<h1 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 24px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">使用 shell 脚本的 6 种技巧</span><span class=\"suffix\" style=\"display: none;\"></span></h1> \n<h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 22px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">1. 全面的错误处理和输入验证</span><span class=\"suffix\" style=\"display: none;\"></span></h2> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">在整个脚本中实现彻底的错误处理和输入验证，可以快速识别和解决问题，从而节省时间。例如：</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">if</span>&nbsp;[&nbsp;-z&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$1</span>\"</span>&nbsp;]&nbsp;<br>&nbsp;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">then</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"Usage:&nbsp;evaluate.sh&nbsp;&lt;fork&nbsp;name&gt;&nbsp;(&lt;fork&nbsp;name&nbsp;2&gt;&nbsp;...)\"</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"&nbsp;for&nbsp;each&nbsp;fork,&nbsp;there&nbsp;must&nbsp;be&nbsp;a&nbsp;'calculate_average_&lt;fork&nbsp;name&gt;.sh'&nbsp;script&nbsp;and&nbsp;an&nbsp;optional&nbsp;'prepare_&lt;fork&nbsp;name&gt;.sh'.\"</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">exit</span>&nbsp;1&nbsp;<br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">fi</span><br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\"><code style=\"color: rgb(30, 107, 184); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all;\">if [ -z \"$1\" ]</code>检查传入的第一个参数（即 <code style=\"color: rgb(30, 107, 184); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all;\">$1</code>）是否为空。 <code style=\"color: rgb(30, 107, 184); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all;\">-z</code> 表示检查变量是否为空。如果 <code style=\"color: rgb(30, 107, 184); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all;\">$1</code> 为空，说明没有传入参数，则条件成立。</p> \n<h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 22px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">2. 清晰多彩的输出</span><span class=\"suffix\" style=\"display: none;\"></span></h2> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">为了使脚本的输出更具可读性，使用 ANSI 颜色代码来突出显示重要信息、警告和错误。例如：</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">BOLD_RED=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'\\033[1;31m'</span><br>RESET=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">'\\033[0m'</span><br><span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;-e&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">${BOLD_RED}</span>ERROR<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">${RESET}</span>:&nbsp;./calculate_average_<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span>.sh&nbsp;does&nbsp;not&nbsp;exist.\"</span>&nbsp;&gt;&amp;2<br></code></pre> \n<h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 22px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">3. 详细的进度报告</span><span class=\"suffix\" style=\"display: none;\"></span></h2> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">为能够准确理解脚本在每个步骤中的作用，可以用以下函数实现，该函数在执行每个命令之前打印每个命令：</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">function</span>&nbsp;<span class=\"hljs-function\" style=\"line-height: 26px;\"><span class=\"hljs-title\" style=\"color: #61aeee; line-height: 26px;\">print_and_execute</span></span>()&nbsp;{<br>&nbsp;&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"+&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$@</span>\"</span>&nbsp;&gt;&amp;2&nbsp;<br>&nbsp;&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$@</span>\"</span>&nbsp;<br>}<br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">这与 Bash 的内置 set -x 跟踪的输出格式匹配，但为脚本作者提供了对打印内容的更精细的控制。</p> \n<h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 22px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">4. 使用 “set -e” 和 “set +e” 进行错误处理</span><span class=\"suffix\" style=\"display: none;\"></span></h2> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">确保脚本在脚本本身出现错误时立即退出，但也允许它在单个 fork 遇到问题时继续运行。为了实现这一点，我在整个脚本中战略性地使用了 Bash 选项 <code style=\"color: rgb(30, 107, 184); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all;\">set -e</code>和 <code style=\"color: rgb(30, 107, 184); font-size: 14px; line-height: 1.8em; letter-spacing: 0em; background-attachment: scroll; background-clip: border-box; background-color: rgba(27, 31, 35, 0.05); background-image: none; background-origin: padding-box; background-position-x: 0%; background-position-y: 0%; background-repeat: no-repeat; background-size: auto; width: auto; height: auto; margin-top: 0px; margin-bottom: 0px; margin-left: 2px; margin-right: 2px; padding-top: 2px; padding-bottom: 2px; padding-left: 4px; padding-right: 4px; border-top-style: none; border-bottom-style: none; border-left-style: none; border-right-style: none; border-top-width: 3px; border-bottom-width: 3px; border-left-width: 3px; border-right-width: 3px; border-top-color: rgb(0, 0, 0); border-bottom-color: rgba(0, 0, 0, 0.4); border-left-color: rgba(0, 0, 0, 0.4); border-right-color: rgba(0, 0, 0, 0.4); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; overflow-wrap: break-word; font-family: Consolas, Monaco, Menlo, monospace; word-break: break-all;\">set +e</code> 。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;At&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;script</span><br><span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">set</span>&nbsp;-eo&nbsp;pipefail<br><br><span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;Before&nbsp;running&nbsp;tests&nbsp;and&nbsp;benchmarks&nbsp;for&nbsp;each&nbsp;fork</span><br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">for</span>&nbsp;fork&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">in</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$@</span>\"</span>;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">do</span><br>&nbsp;&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">set</span>&nbsp;+e&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;we&nbsp;don't&nbsp;want&nbsp;prepare.sh,&nbsp;test.sh&nbsp;or&nbsp;hyperfine&nbsp;failing&nbsp;on&nbsp;1&nbsp;fork&nbsp;to&nbsp;exit&nbsp;the&nbsp;script&nbsp;early</span><br><br>&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;Run&nbsp;prepare&nbsp;script&nbsp;(simplified)</span><br>&nbsp;&nbsp;print_and_execute&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">source</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"./prepare_<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span>.sh\"</span><br><br>&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;Run&nbsp;the&nbsp;test&nbsp;suite&nbsp;(simplified)</span><br>&nbsp;&nbsp;print_and_execute&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$TIMEOUT</span>&nbsp;./test.sh&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span><br><br>&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;...&nbsp;(other&nbsp;fork-specific&nbsp;operations)</span><br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">done</span><br><span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">set</span>&nbsp;-e&nbsp;&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;Re-enable&nbsp;exit&nbsp;on&nbsp;error&nbsp;after&nbsp;the&nbsp;fork-specific&nbsp;operations</span><br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">这种方法使脚本作者能够精细控制哪些错误会导致脚本退出，哪些错误可以通过其他方式处理。</p> \n<h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 22px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">5. 特定于平台的调整</span><span class=\"suffix\" style=\"display: none;\"></span></h2> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">不同的人可能会在不同的操作系统上运行此脚本，因此添加了逻辑来检测操作系统并相应地调整脚本的行为：</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\"><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">if</span>&nbsp;[&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$(uname&nbsp;-s)</span>\"</span>&nbsp;==&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"Linux\"</span>&nbsp;];&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">then</span>&nbsp;<br>&nbsp;&nbsp;TIMEOUT=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"timeout&nbsp;-v&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$RUN_TIME_LIMIT</span>\"</span>&nbsp;<br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">else</span>&nbsp;<span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;Assume&nbsp;MacOS&nbsp;</span><br>&nbsp;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">if</span>&nbsp;[&nbsp;-x&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$(command&nbsp;-v&nbsp;gtimeout)</span>\"</span>&nbsp;];&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">then</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;TIMEOUT=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"gtimeout&nbsp;-v&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$RUN_TIME_LIMIT</span>\"</span><br>&nbsp;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">else</span>&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;-e&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">${BOLD_YELLOW}</span>WARNING<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">${RESET}</span>&nbsp;gtimeout&nbsp;not&nbsp;available,&nbsp;install&nbsp;with&nbsp;`brew&nbsp;install&nbsp;coreutils`&nbsp;or&nbsp;benchmark&nbsp;runs&nbsp;may&nbsp;take&nbsp;indefinitely&nbsp;long.\"</span>&nbsp;<br>&nbsp;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">fi</span><br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">fi</span><br></code></pre> \n<h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px; margin-bottom: 15px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; display: block;\"><span class=\"prefix\" style=\"display: none;\"></span><span class=\"content\" style=\"font-size: 22px; color: rgb(0, 0, 0); line-height: 1.5em; letter-spacing: 0em; text-align: left; font-weight: bold; display: block;\">6. 多次运行的带时间戳的文件输出</span><span class=\"suffix\" style=\"display: none;\"></span></h2> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">为了支持多个基准测试运行而不覆盖以前的结果，实施了一个带时间戳的文件输出系统。这允许多次运行脚本并保留所有结果的历史记录。</p> \n<pre class=\"custom\" data-tool=\"mdnice编辑器\" style=\"border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px; text-align: left; margin-top: 10px; margin-bottom: 10px; margin-left: 0px; margin-right: 0px; padding-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px;\"><span style=\"display: block; background: url(https://files.mdnice.com/user/3441/876cad08-0422-409d-bb5a-08afec5da8ee.svg); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #282c34; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;\"></span><code class=\"hljs\" style=\"overflow-x: auto; padding: 16px; color: #abb2bf; padding-top: 15px; background: #282c34; border-radius: 5px; display: -webkit-box; font-family: Consolas, Monaco, Menlo, monospace; font-size: 12px;\">filetimestamp=$(date&nbsp;+<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"%Y%m%d%H%M%S\"</span>)<br><br><span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;...&nbsp;(in&nbsp;the&nbsp;loop&nbsp;for&nbsp;each&nbsp;fork)</span><br>HYPERFINE_OPTS=<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"--warmup&nbsp;0&nbsp;--runs&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$RUNS</span>&nbsp;--export-json&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span>-<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$filetimestamp</span>-timing.json&nbsp;--output&nbsp;./<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span>-<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$filetimestamp</span>.out\"</span><br><br><span class=\"hljs-comment\" style=\"color: #5c6370; font-style: italic; line-height: 26px;\">#&nbsp;...&nbsp;(after&nbsp;the&nbsp;benchmarks)</span><br><span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"Raw&nbsp;results&nbsp;saved&nbsp;to&nbsp;file(s):\"</span><br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">for</span>&nbsp;fork&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">in</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$@</span>\"</span>;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">do</span><br>&nbsp;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">if</span>&nbsp;[&nbsp;-f&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span>-<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$filetimestamp</span>-timing.json\"</span>&nbsp;];&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">then</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span>-<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$filetimestamp</span>-timing.json&nbsp;&gt;&gt;&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span>-<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$filetimestamp</span>.out<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rm&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span>-<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$filetimestamp</span>-timing.json<br>&nbsp;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">fi</span><br><br>&nbsp;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">if</span>&nbsp;[&nbsp;-f&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span>-<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$filetimestamp</span>.out\"</span>&nbsp;];&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">then</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"hljs-built_in\" style=\"color: #e6c07b; line-height: 26px;\">echo</span>&nbsp;<span class=\"hljs-string\" style=\"color: #98c379; line-height: 26px;\">\"&nbsp;&nbsp;<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$fork</span>-<span class=\"hljs-variable\" style=\"color: #d19a66; line-height: 26px;\">$filetimestamp</span>.out\"</span><br>&nbsp;&nbsp;<span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">fi</span><br><span class=\"hljs-keyword\" style=\"color: #c678dd; line-height: 26px;\">done</span><br></code></pre> \n<p data-tool=\"mdnice编辑器\" style=\"color: rgb(0, 0, 0); font-size: 16px; line-height: 1.8em; letter-spacing: 0em; text-align: left; text-indent: 0em; margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; padding-top: 8px; padding-bottom: 8px; padding-left: 0px; padding-right: 0px;\">参考来源：https://nochlin.com/blog/6-techniques-i-use-to-create-a-great-user-experience-for-shell-scripts</p>",
                "title": "使用 shell 脚本的 6 种技巧",
                "categoryId": 1,
                "categoryName": "后端",
                "tagId": 179,
                "tagName": "运维部署",
                "userId": 58457,
                "userOutId": "175763908540",
                "username": "染山",
                "avatar": "",
                "description": "使用shell脚本的6种技巧1.全面的错误处理和输入验证在整个脚本中实现彻底的错误处理和输入验证，可以快速识别和解决问题，从而节省时间。例如：if&nbsp;[&nbsp;-z&nbsp;\"$1\"&n",
                "level": 1,
                "publishTime": "2024/11/06",
                "readingNum": 4,
                "likeNum": 0,
                "introduction": null,
                "followWords": null,
                "followPic": null,
                "isFollowing": false,
                "isLike": false,
                "isSelf": false,
                "type": 1,
                "isVisible": true,
                "invisibleReason": null,
                "writingColumn": {
                    "columnOutId": "8fd4615c27964cc6b574ee6aedd19a21",
                    "name": "默认专栏",
                    "briefIntro": "这是一个默认专栏",
                    "cover": "https://files.mdnice.com/common/community/default-column-cover.jpg",
                    "writingNum": 19,
                    "createTime": "2024-08-06 19:03"
                }
            }
        },
        "__N_SSP": true
    },
    "page": "/writing/[id]",
    "query": {
        "id": "ec3dbe62e02a42fc9fa4525666d5052e"
    },
    "buildId": "ErZPkD4oq6iwH2nj6Dpcx",
    "isFallback": false,
    "gssp": true,
    "appGip": true
}